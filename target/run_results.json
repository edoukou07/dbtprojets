{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.15", "generated_at": "2025-11-13T02:51:33.129145Z", "invocation_id": "4e3d2363-b3a2-42fc-a3c2-14ffc9470eed", "invocation_started_at": "2025-11-13T02:51:31.139248Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:32.804086Z", "completed_at": "2025-11-13T02:51:32.815646Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:32.817643Z", "completed_at": "2025-11-13T02:51:32.817643Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.04837846755981445, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.stg_collectes", "compiled": true, "compiled_code": "\n\nselect\n    id,\n    reference,\n    montant_a_recouvrer,\n    montant_recouvre,\n    date_debut,\n    date_fin_prevue,\n    status,\n    commentaire,\n    cree_par,\n    modifie_par,\n    created_at,\n    updated_at,\n    statut_cloture,\n    date_cloture,\n    cloture_par,\n    entreprises_selectionnees,\n    factures_generees,\n    date_generation_factures\nfrom \"sigeti_node_db\".\"public\".\"collectes\"\nwhere id is not null", "relation_name": "\"sigeti_node_db\".\"dwh_staging\".\"stg_collectes\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:32.804086Z", "completed_at": "2025-11-13T02:51:32.817643Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:32.820523Z", "completed_at": "2025-11-13T02:51:32.820523Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.051656484603881836, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.stg_demandes_attribution", "compiled": true, "compiled_code": "\n\nselect\n    id,\n    reference,\n    statut,\n    etape_courante,\n    type_demande,\n    entreprise_id,\n    lot_id,\n    zone_id,\n    informations_terrain,\n    coordonnees_geospatiales,\n    financement,\n    emplois,\n    priorite,\n    decisions_commissions,\n    historique_etapes,\n    retours,\n    metadata,\n    user_id,\n    created_at,\n    updated_at\nfrom \"sigeti_node_db\".\"public\".\"demandes_attribution\"\nwhere id is not null", "relation_name": "\"sigeti_node_db\".\"dwh_staging\".\"stg_demandes_attribution\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:32.809102Z", "completed_at": "2025-11-13T02:51:32.819311Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:32.822014Z", "completed_at": "2025-11-13T02:51:32.822014Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.05374431610107422, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.stg_domaines_activites", "compiled": true, "compiled_code": "\n\nselect\n    id,\n    libelle,\n    description,\n    created_at,\n    updated_at\nfrom \"sigeti_node_db\".\"public\".\"domaines_activites\"\nwhere id is not null", "relation_name": "\"sigeti_node_db\".\"dwh_staging\".\"stg_domaines_activites\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:32.827677Z", "completed_at": "2025-11-13T02:51:32.839407Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:32.839407Z", "completed_at": "2025-11-13T02:51:32.839407Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.015398025512695312, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.stg_entreprises", "compiled": true, "compiled_code": "\n\nselect\n    id,\n    raison_sociale,\n    telephone,\n    email,\n    registre_commerce,\n    compte_contribuable,\n    forme_juridique,\n    adresse,\n    date_constitution,\n    domaine_activite_id,\n    entreprise_id,\n    user_id,\n    date_creation,\n    date_modification\nfrom \"sigeti_node_db\".\"public\".\"entreprises\"\nwhere id is not null", "relation_name": "\"sigeti_node_db\".\"dwh_staging\".\"stg_entreprises\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:32.833202Z", "completed_at": "2025-11-13T02:51:32.839407Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:32.839407Z", "completed_at": "2025-11-13T02:51:32.839407Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.013397932052612305, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.stg_factures", "compiled": true, "compiled_code": "\n\nselect\n    id,\n    numero_facture,\n    date_creation,\n    date_echeance,\n    date_paiement,\n    montant_total,\n    sous_total,\n    statut,\n    entreprise_id,\n    processus_origine,\n    demande_attribution_id,\n    collecte_id,\n    ayant_droit_id,\n    created_by,\n    updated_by,\n    version,\n    is_deleted,\n    deleted_at,\n    purge_id\nfrom \"sigeti_node_db\".\"public\".\"factures\"\nwhere id is not null\n  and (is_deleted is null or is_deleted = false)", "relation_name": "\"sigeti_node_db\".\"dwh_staging\".\"stg_factures\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:32.835203Z", "completed_at": "2025-11-13T02:51:32.839407Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:32.839407Z", "completed_at": "2025-11-13T02:51:32.839407Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.01239466667175293, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.stg_lots", "compiled": true, "compiled_code": "\n\nselect\n    id,\n    numero,\n    ilot,\n    superficie,\n    unite_mesure,\n    prix,\n    statut,\n    priorite,\n    viabilite,\n    description,\n    coordonnees,\n    zone_industrielle_id,\n    zone_id,\n    entreprise_id,\n    date_acquisition,\n    date_reservation,\n    delai_option,\n    polygon,\n    location,\n    operateur_id,\n    created_at,\n    updated_at\nfrom \"sigeti_node_db\".\"public\".\"lots\"\nwhere id is not null", "relation_name": "\"sigeti_node_db\".\"dwh_staging\".\"stg_lots\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:32.849131Z", "completed_at": "2025-11-13T02:51:32.850883Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:32.868997Z", "completed_at": "2025-11-13T02:51:32.868997Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.029590129852294922, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.stg_paiements", "compiled": true, "compiled_code": "\n\nselect\n    id,\n    facture_id,\n    montant,\n    date_paiement,\n    mode_paiement,\n    statut,\n    reference_paiement,\n    piece_justificative,\n    created_at,\n    updated_at\nfrom \"sigeti_node_db\".\"public\".\"paiement_factures\"\nwhere id is not null", "relation_name": "\"sigeti_node_db\".\"dwh_staging\".\"stg_paiements\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:32.850883Z", "completed_at": "2025-11-13T02:51:32.868997Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:32.868997Z", "completed_at": "2025-11-13T02:51:32.868997Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.019866228103637695, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.stg_zones_industrielles", "compiled": true, "compiled_code": "\n\nselect\n    id,\n    libelle,\n    description,\n    created_at,\n    updated_at\nfrom \"sigeti_node_db\".\"public\".\"zones_industrielles\"\nwhere id is not null", "relation_name": "\"sigeti_node_db\".\"dwh_staging\".\"stg_zones_industrielles\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:32.859205Z", "completed_at": "2025-11-13T02:51:32.868997Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:32.868997Z", "completed_at": "2025-11-13T02:51:32.868997Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.018114566802978516, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.source_not_null_sigeti_source_entreprises_id.377687be8a", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect id\nfrom \"sigeti_node_db\".\"public\".\"entreprises\"\nwhere id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:32.879109Z", "completed_at": "2025-11-13T02:51:32.884705Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:32.889312Z", "completed_at": "2025-11-13T02:51:32.889312Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.020315170288085938, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.source_not_null_sigeti_source_factures_id.2ade065255", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect id\nfrom \"sigeti_node_db\".\"public\".\"factures\"\nwhere id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:32.889312Z", "completed_at": "2025-11-13T02:51:32.909395Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:32.914436Z", "completed_at": "2025-11-13T02:51:32.914436Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.029731273651123047, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.source_not_null_sigeti_source_lots_id.7c99ea6c34", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect id\nfrom \"sigeti_node_db\".\"public\".\"lots\"\nwhere id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:32.889312Z", "completed_at": "2025-11-13T02:51:32.914436Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:32.914436Z", "completed_at": "2025-11-13T02:51:32.914436Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.029731273651123047, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.source_not_null_sigeti_source_zones_industrielles_id.af9994522e", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect id\nfrom \"sigeti_node_db\".\"public\".\"zones_industrielles\"\nwhere id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:32.769265Z", "completed_at": "2025-11-13T02:51:32.914436Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:32.924145Z", "completed_at": "2025-11-13T02:51:32.924145Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.1655104160308838, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.dim_temps", "compiled": true, "compiled_code": "\n\nwith date_spine as (\n    \n\n\n\n\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * power(2, 0)\n     + \n    \n    p1.generated_number * power(2, 1)\n     + \n    \n    p2.generated_number * power(2, 2)\n     + \n    \n    p3.generated_number * power(2, 3)\n     + \n    \n    p4.generated_number * power(2, 4)\n     + \n    \n    p5.generated_number * power(2, 5)\n     + \n    \n    p6.generated_number * power(2, 6)\n     + \n    \n    p7.generated_number * power(2, 7)\n     + \n    \n    p8.generated_number * power(2, 8)\n     + \n    \n    p9.generated_number * power(2, 9)\n     + \n    \n    p10.generated_number * power(2, 10)\n     + \n    \n    p11.generated_number * power(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 4017\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n\n    cast('2020-01-01' as date) + ((interval '1 day') * (row_number() over (order by 1) - 1))\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast('2030-12-31' as date)\n\n)\n\nselect * from filtered\n\n\n),\n\ndates as (\n    select\n        cast(date_day as date) as date_full,\n        cast(to_char(date_day, 'YYYYMMDD') as integer) as date_key,\n        extract(year from date_day) as annee,\n        extract(month from date_day) as mois,\n        extract(day from date_day) as jour,\n        extract(quarter from date_day) as trimestre,\n        extract(week from date_day) as semaine,\n        extract(dow from date_day) as jour_semaine,\n        to_char(date_day, 'Month') as nom_mois,\n        to_char(date_day, 'Day') as nom_jour,\n        case \n            when extract(month from date_day) between 1 and 3 then 'T1'\n            when extract(month from date_day) between 4 and 6 then 'T2'\n            when extract(month from date_day) between 7 and 9 then 'T3'\n            else 'T4'\n        end as libelle_trimestre,\n        case \n            when extract(dow from date_day) in (0, 6) then true\n            else false\n        end as est_weekend,\n        case \n            when extract(month from date_day) = 1 and extract(day from date_day) = 1 then 'Jour de l''An'\n            when extract(month from date_day) = 5 and extract(day from date_day) = 1 then 'F\u00eate du Travail'\n            when extract(month from date_day) = 8 and extract(day from date_day) = 7 then 'F\u00eate de l''Ind\u00e9pendance'\n            when extract(month from date_day) = 12 and extract(day from date_day) = 25 then 'No\u00ebl'\n            else null\n        end as jour_ferie\n    from date_spine\n)\n\nselect * from dates", "relation_name": "\"sigeti_node_db\".\"dwh_dimensions\".\"dim_temps\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:32.919012Z", "completed_at": "2025-11-13T02:51:32.929041Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:32.930633Z", "completed_at": "2025-11-13T02:51:32.930633Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.021237611770629883, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.source_unique_sigeti_source_entreprises_id.0e1558dbe3", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    id as unique_field,\n    count(*) as n_records\n\nfrom \"sigeti_node_db\".\"public\".\"entreprises\"\nwhere id is not null\ngroup by id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:32.930633Z", "completed_at": "2025-11-13T02:51:32.939157Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:32.946420Z", "completed_at": "2025-11-13T02:51:32.946420Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.022274255752563477, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.source_unique_sigeti_source_factures_id.fb4b49fadd", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    id as unique_field,\n    count(*) as n_records\n\nfrom \"sigeti_node_db\".\"public\".\"factures\"\nwhere id is not null\ngroup by id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:32.939157Z", "completed_at": "2025-11-13T02:51:32.946420Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:32.949227Z", "completed_at": "2025-11-13T02:51:32.949227Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.020186424255371094, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.source_unique_sigeti_source_lots_id.a51cca0839", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    id as unique_field,\n    count(*) as n_records\n\nfrom \"sigeti_node_db\".\"public\".\"lots\"\nwhere id is not null\ngroup by id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:32.949227Z", "completed_at": "2025-11-13T02:51:33.019160Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:33.019160Z", "completed_at": "2025-11-13T02:51:33.019160Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.08000349998474121, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.source_unique_sigeti_source_zones_industrielles_id.752cef061d", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    id as unique_field,\n    count(*) as n_records\n\nfrom \"sigeti_node_db\".\"public\".\"zones_industrielles\"\nwhere id is not null\ngroup by id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:32.949227Z", "completed_at": "2025-11-13T02:51:33.019160Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:33.029117Z", "completed_at": "2025-11-13T02:51:33.029117Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.08996009826660156, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.fait_collectes", "compiled": true, "compiled_code": "\n\nwith collectes as (\n    select * from \"sigeti_node_db\".\"dwh_staging\".\"stg_collectes\"\n),\n\nfinal as (\n    select\n        -- Cl\u00e9 surrogate\n        md5(cast(coalesce(cast(id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(date_debut as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as collecte_key,\n        \n        -- Cl\u00e9s \u00e9trang\u00e8res (dimensions)\n        cast(to_char(date_debut, 'YYYYMMDD') as integer) as date_debut_key,\n        cast(to_char(date_fin_prevue, 'YYYYMMDD') as integer) as date_fin_prevue_key,\n        cast(to_char(date_cloture, 'YYYYMMDD') as integer) as date_cloture_key,\n        \n        -- Cl\u00e9s naturelles\n        id as collecte_id,\n        reference,\n        \n        -- Mesures\n        montant_a_recouvrer,\n        montant_recouvre,\n        montant_a_recouvrer - montant_recouvre as montant_restant,\n        \n        -- Ratios\n        case \n            when montant_a_recouvrer > 0 \n            then (montant_recouvre::numeric / montant_a_recouvrer::numeric) * 100\n            else 0\n        end as taux_recouvrement,\n        \n        -- Attributs\n        status,\n        statut_cloture,\n        \n        -- Dates\n        date_debut,\n        date_fin_prevue,\n        date_cloture,\n        date_generation_factures,\n        \n        -- Calculs\n        (date_fin_prevue - date_debut) as duree_prevue_jours,\n        \n        case \n            when date_cloture is not null \n            then (date_cloture::date - date_debut)\n            else (current_date - date_debut)\n        end as duree_reelle_jours,\n        \n        -- Indicateurs\n        factures_generees,\n        \n        case \n            when statut_cloture = 'cloturee' then true\n            else false\n        end as est_cloturee,\n        \n        case \n            when montant_recouvre >= montant_a_recouvrer then true\n            else false\n        end as est_complete,\n        \n        -- Audit\n        cree_par,\n        cloture_par\n        \n    from collectes\n    \n    \n        where date_debut >= (select max(date_debut) from \"sigeti_node_db\".\"dwh_facts\".\"fait_collectes\")\n    \n)\n\nselect * from final", "relation_name": "\"sigeti_node_db\".\"dwh_facts\".\"fait_collectes\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:33.019160Z", "completed_at": "2025-11-13T02:51:33.039372Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:33.043774Z", "completed_at": "2025-11-13T02:51:33.043774Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.02461385726928711, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.dim_domaines_activites", "compiled": true, "compiled_code": "\n\nwith source as (\n    select * from \"sigeti_node_db\".\"dwh_staging\".\"stg_domaines_activites\"\n),\n\ndomaines_enrichis as (\n    select\n        -- Cl\u00e9 surrogate\n        md5(cast(coalesce(cast(id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as domaine_key,\n        \n        -- Cl\u00e9s naturelles\n        id as domaine_id,\n        \n        -- Attributs\n        libelle as nom_domaine,\n        description,\n        \n        -- M\u00e9tadonn\u00e9es\n        created_at,\n        updated_at\n        \n    from source\n)\n\nselect * from domaines_enrichis", "relation_name": "\"sigeti_node_db\".\"dwh_dimensions\".\"dim_domaines_activites\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:33.029117Z", "completed_at": "2025-11-13T02:51:33.042379Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:33.052862Z", "completed_at": "2025-11-13T02:51:33.052862Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.03370165824890137, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.dim_entreprises", "compiled": true, "compiled_code": "\n\nwith source as (\n    select * from \"sigeti_node_db\".\"dwh_staging\".\"stg_entreprises\"\n),\n\nentreprises_enrichies as (\n    select\n        -- Cl\u00e9 surrogate\n        md5(cast(coalesce(cast(id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as entreprise_key,\n        \n        -- Cl\u00e9s naturelles\n        id as entreprise_id,\n        \n        -- Attributs\n        raison_sociale,\n        telephone,\n        email,\n        registre_commerce,\n        compte_contribuable,\n        forme_juridique,\n        adresse,\n        date_constitution,\n        \n        -- Cl\u00e9s \u00e9trang\u00e8res\n        domaine_activite_id,\n        user_id as representant_user_id,\n        \n        -- M\u00e9tadonn\u00e9es SCD Type 2\n        date_creation as valid_from,\n        date_modification as valid_to,\n        case \n            when date_modification is null then true \n            else false \n        end as is_current\n        \n    from source\n)\n\nselect * from entreprises_enrichies", "relation_name": "\"sigeti_node_db\".\"dwh_dimensions\".\"dim_entreprises\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:33.046280Z", "completed_at": "2025-11-13T02:51:33.060389Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:33.060389Z", "completed_at": "2025-11-13T02:51:33.060389Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.021016597747802734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.fait_factures", "compiled": true, "compiled_code": "\n\nwith factures as (\n    select * from \"sigeti_node_db\".\"dwh_staging\".\"stg_factures\"\n),\n\nfinal as (\n    select\n        -- Cl\u00e9 surrogate\n        md5(cast(coalesce(cast(id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(date_creation as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as facture_key,\n        \n        -- Cl\u00e9s \u00e9trang\u00e8res (dimensions)\n        cast(to_char(date_creation, 'YYYYMMDD') as integer) as date_creation_key,\n        cast(to_char(coalesce(date_paiement, date_creation), 'YYYYMMDD') as integer) as date_paiement_key,\n        entreprise_id,\n        collecte_id,\n        demande_attribution_id,\n        ayant_droit_id,\n        \n        -- Cl\u00e9s naturelles\n        id as facture_id,\n        numero_facture,\n        \n        -- Mesures\n        montant_total,\n        sous_total,\n        montant_total - sous_total as montant_taxes,\n        \n        -- Attributs\n        statut,\n        processus_origine,\n        \n        -- Dates\n        date_creation,\n        date_echeance,\n        date_paiement,\n        \n        -- Calculs\n        case \n            when date_paiement is not null then date_paiement - date_creation\n            else current_date - date_creation\n        end as delai_paiement_jours,\n        \n        case \n            when date_paiement is null and current_date > date_echeance then true\n            else false\n        end as est_en_retard,\n        \n        case \n            when date_paiement is not null then true\n            else false\n        end as est_paye,\n        \n        -- Audit\n        created_by,\n        updated_by,\n        version\n        \n    from factures\n    \n    \n        where date_creation >= (select max(date_creation) from \"sigeti_node_db\".\"dwh_facts\".\"fait_factures\")\n    \n)\n\nselect * from final", "relation_name": "\"sigeti_node_db\".\"dwh_facts\".\"fait_factures\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:33.054873Z", "completed_at": "2025-11-13T02:51:33.060389Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:33.069342Z", "completed_at": "2025-11-13T02:51:33.069342Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.029969453811645508, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.dim_lots", "compiled": true, "compiled_code": "\n\nwith source as (\n    select * from \"sigeti_node_db\".\"dwh_staging\".\"stg_lots\"\n),\n\nlots_enrichis as (\n    select\n        -- Cl\u00e9 surrogate\n        md5(cast(coalesce(cast(id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as lot_key,\n        \n        -- Cl\u00e9s naturelles\n        id as lot_id,\n        numero as numero_lot,\n        ilot,\n        \n        -- Attributs\n        superficie,\n        unite_mesure,\n        prix,\n        statut,\n        priorite,\n        viabilite,\n        description,\n        coordonnees,\n        polygon,\n        location,\n        \n        -- Cl\u00e9s \u00e9trang\u00e8res\n        zone_industrielle_id,\n        zone_id,\n        entreprise_id,\n        operateur_id,\n        \n        -- Dates\n        date_acquisition,\n        date_reservation,\n        delai_option,\n        created_at,\n        updated_at,\n        \n        -- M\u00e9tadonn\u00e9es\n        case when statut = 'disponible' then true else false end as est_disponible,\n        case when viabilite = true then true else false end as est_viable,\n        case when entreprise_id is not null then true else false end as est_attribue\n        \n    from source\n)\n\nselect * from lots_enrichis", "relation_name": "\"sigeti_node_db\".\"dwh_dimensions\".\"dim_lots\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:33.060389Z", "completed_at": "2025-11-13T02:51:33.080777Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:33.080777Z", "completed_at": "2025-11-13T02:51:33.080777Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.021395444869995117, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.fait_attributions", "compiled": true, "compiled_code": "\n\nwith demandes as (\n    select * from \"sigeti_node_db\".\"dwh_staging\".\"stg_demandes_attribution\"\n),\n\nlots as (\n    select \n        id,\n        superficie,\n        prix,\n        zone_industrielle_id\n    from \"sigeti_node_db\".\"dwh_staging\".\"stg_lots\"\n),\n\nfinal as (\n    select\n        -- Cl\u00e9 surrogate\n        md5(cast(coalesce(cast(d.id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(d.created_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as attribution_key,\n        \n        -- Cl\u00e9s \u00e9trang\u00e8res (dimensions)\n        cast(to_char(d.created_at, 'YYYYMMDD') as integer) as date_demande_key,\n        d.entreprise_id,\n        d.lot_id,\n        coalesce(d.zone_id, l.zone_industrielle_id) as zone_id,\n        \n        -- Cl\u00e9s naturelles\n        d.id as demande_id,\n        d.reference,\n        \n        -- Mesures\n        l.superficie as superficie_demandee,\n        l.prix as montant_attribution,\n        \n        -- Attributs\n        d.statut,\n        d.type_demande,\n        d.etape_courante,\n        d.priorite,\n        \n        -- Dates\n        d.created_at as date_demande,\n        d.updated_at as date_modification,\n        \n        -- Calculs\n        case \n            when d.updated_at is not null \n            then extract(day from (d.updated_at - d.created_at))\n            else extract(day from (current_timestamp - d.created_at))\n        end as delai_traitement_jours,\n        \n        -- Indicateurs\n        case \n            when d.statut::text in ('approuve', 'attribue', 'accepte') then true\n            else false\n        end as est_approuve,\n        \n        case \n            when d.statut::text = 'rejete' then true\n            else false\n        end as est_rejete,\n        \n        case \n            when d.statut::text in ('en_attente', 'en_cours') then true\n            else false\n        end as est_en_attente\n        \n    from demandes d\n    left join lots l on d.lot_id = l.id\n    \n    \n        where d.created_at >= (select max(date_demande) from \"sigeti_node_db\".\"dwh_facts\".\"fait_attributions\")\n    \n)\n\nselect * from final", "relation_name": "\"sigeti_node_db\".\"dwh_facts\".\"fait_attributions\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:33.069342Z", "completed_at": "2025-11-13T02:51:33.080777Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:33.089332Z", "completed_at": "2025-11-13T02:51:33.089332Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.02894306182861328, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.fait_paiements", "compiled": true, "compiled_code": "\n\nwith paiements as (\n    select * from \"sigeti_node_db\".\"dwh_staging\".\"stg_paiements\"\n),\n\nfactures as (\n    select \n        id,\n        entreprise_id,\n        montant_total,\n        collecte_id\n    from \"sigeti_node_db\".\"dwh_staging\".\"stg_factures\"\n),\n\nfinal as (\n    select\n        -- Cl\u00e9 surrogate\n        md5(cast(coalesce(cast(p.id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(p.date_paiement as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as paiement_key,\n        \n        -- Cl\u00e9s \u00e9trang\u00e8res (dimensions)\n        cast(to_char(p.date_paiement, 'YYYYMMDD') as integer) as date_paiement_key,\n        f.entreprise_id,\n        p.facture_id,\n        f.collecte_id,\n        \n        -- Cl\u00e9s naturelles\n        p.id as paiement_id,\n        p.reference_paiement,\n        \n        -- Mesures\n        p.montant as montant_paiement,\n        f.montant_total as montant_facture,\n        f.montant_total - p.montant as reste_a_payer,\n        \n        -- Attributs\n        p.mode_paiement,\n        p.statut,\n        \n        -- Dates\n        p.date_paiement,\n        \n        -- Indicateurs\n        case \n            when p.montant >= f.montant_total then true\n            else false\n        end as paiement_complet,\n        \n        case \n            when p.montant < f.montant_total then true\n            else false\n        end as paiement_partiel\n        \n    from paiements p\n    left join factures f on p.facture_id = f.id\n    \n    \n        where p.date_paiement >= (select max(date_paiement) from \"sigeti_node_db\".\"dwh_facts\".\"fait_paiements\")\n    \n)\n\nselect * from final", "relation_name": "\"sigeti_node_db\".\"dwh_facts\".\"fait_paiements\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:33.080777Z", "completed_at": "2025-11-13T02:51:33.094210Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:33.094210Z", "completed_at": "2025-11-13T02:51:33.094210Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.013433218002319336, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.dim_zones_industrielles", "compiled": true, "compiled_code": "\n\nwith source as (\n    select * from \"sigeti_node_db\".\"dwh_staging\".\"stg_zones_industrielles\"\n),\n\nzones_enrichies as (\n    select\n        -- Cl\u00e9 surrogate\n        md5(cast(coalesce(cast(id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as zone_key,\n        \n        -- Cl\u00e9s naturelles\n        id as zone_id,\n        \n        -- Attributs\n        libelle as nom_zone,\n        description,\n        \n        -- M\u00e9tadonn\u00e9es\n        created_at,\n        updated_at\n        \n    from source\n)\n\nselect * from zones_enrichies", "relation_name": "\"sigeti_node_db\".\"dwh_dimensions\".\"dim_zones_industrielles\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:33.094210Z", "completed_at": "2025-11-13T02:51:33.109209Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:33.109209Z", "completed_at": "2025-11-13T02:51:33.109209Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.017009735107421875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.mart_kpi_operationnels", "compiled": true, "compiled_code": "\n\n-- Mart Op\u00e9rationnel - Indicateurs de performance op\u00e9rationnelle\n\nwith collectes as (\n    select * from \"sigeti_node_db\".\"dwh_facts\".\"fait_collectes\"\n),\n\nattributions as (\n    select * from \"sigeti_node_db\".\"dwh_facts\".\"fait_attributions\"\n),\n\nfactures as (\n    select * from \"sigeti_node_db\".\"dwh_facts\".\"fait_factures\"\n),\n\ntemps as (\n    select * from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_temps\"\n),\n\nperformance_collectes as (\n    select\n        t.annee,\n        t.trimestre,\n        t.nom_mois,\n        \n        -- Volume\n        count(*) as nombre_collectes,\n        count(case when c.est_cloturee then 1 end) as collectes_cloturees,\n        count(case when not c.est_cloturee then 1 end) as collectes_ouvertes,\n        \n        -- Performance\n        avg(c.taux_recouvrement) as taux_recouvrement_moyen,\n        avg(c.duree_reelle_jours) as duree_moyenne_jours,\n        \n        -- Volumes financiers\n        sum(c.montant_a_recouvrer) as montant_total_a_recouvrer,\n        sum(c.montant_recouvre) as montant_total_recouvre,\n        \n        -- Efficacit\u00e9\n        round(\n            (count(case when c.est_cloturee then 1 end)::numeric / \n             nullif(count(*), 0)::numeric * 100), \n            2\n        ) as taux_cloture_pct,\n        \n        round(\n            (sum(c.montant_recouvre)::numeric / \n             nullif(sum(c.montant_a_recouvrer), 0)::numeric * 100), \n            2\n        ) as taux_recouvrement_global_pct\n        \n    from collectes c\n    join temps t on c.date_debut_key = t.date_key\n    \n    group by \n        t.annee,\n        t.trimestre,\n        t.nom_mois\n),\n\nperformance_attributions as (\n    select\n        t.annee,\n        t.trimestre,\n        \n        count(*) as nombre_demandes,\n        count(case when a.est_approuve then 1 end) as demandes_approuvees,\n        count(case when a.est_rejete then 1 end) as demandes_rejetees,\n        count(case when a.est_en_attente then 1 end) as demandes_en_attente,\n        \n        avg(a.delai_traitement_jours) as delai_moyen_traitement,\n        \n        round(\n            (count(case when a.est_approuve then 1 end)::numeric / \n             nullif(count(*), 0)::numeric * 100), \n            2\n        ) as taux_approbation_pct,\n        \n        sum(a.superficie_demandee) as superficie_totale_demandee\n        \n    from attributions a\n    join temps t on a.date_demande_key = t.date_key\n    \n    group by \n        t.annee,\n        t.trimestre\n),\n\nperformance_facturation as (\n    select\n        t.annee,\n        t.trimestre,\n        \n        count(*) as nombre_factures_emises,\n        count(case when f.est_paye then 1 end) as factures_payees,\n        avg(case when f.est_paye then f.delai_paiement_jours end) as delai_moyen_paiement,\n        \n        sum(f.montant_total) as montant_total_facture,\n        sum(case when f.est_paye then f.montant_total else 0 end) as montant_paye\n        \n    from factures f\n    join temps t on f.date_creation_key = t.date_key\n    \n    group by \n        t.annee,\n        t.trimestre\n)\n\nselect\n    c.annee,\n    c.trimestre,\n    c.nom_mois,\n    \n    -- Collectes\n    c.nombre_collectes,\n    c.collectes_cloturees,\n    c.collectes_ouvertes,\n    c.taux_recouvrement_moyen,\n    c.duree_moyenne_jours as duree_moyenne_collecte_jours,\n    c.taux_cloture_pct,\n    c.taux_recouvrement_global_pct,\n    \n    -- Attributions\n    a.nombre_demandes,\n    a.demandes_approuvees,\n    a.demandes_rejetees,\n    a.demandes_en_attente,\n    a.delai_moyen_traitement as delai_moyen_attribution_jours,\n    a.taux_approbation_pct,\n    \n    -- Facturation\n    f.nombre_factures_emises,\n    f.factures_payees,\n    f.delai_moyen_paiement as delai_moyen_paiement_jours,\n    \n    -- Volumes financiers\n    c.montant_total_a_recouvrer,\n    c.montant_total_recouvre,\n    f.montant_total_facture,\n    f.montant_paye\n    \nfrom performance_collectes c\nleft join performance_attributions a \n    on c.annee = a.annee and c.trimestre = a.trimestre\nleft join performance_facturation f \n    on c.annee = f.annee and c.trimestre = f.trimestre\n    \norder by c.annee desc, c.trimestre desc", "relation_name": "\"sigeti_node_db\".\"dwh_marts_operationnel\".\"mart_kpi_operationnels\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:33.099386Z", "completed_at": "2025-11-13T02:51:33.109209Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:33.109209Z", "completed_at": "2025-11-13T02:51:33.109209Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.017009735107421875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.mart_portefeuille_clients", "compiled": true, "compiled_code": "\n\n-- Mart Clients - Analyse du portefeuille clients/entreprises\n\nwith entreprises as (\n    select * from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_entreprises\"\n),\n\ndomaines as (\n    select * from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_domaines_activites\"\n),\n\nfactures as (\n    select * from \"sigeti_node_db\".\"dwh_facts\".\"fait_factures\"\n),\n\nattributions as (\n    select * from \"sigeti_node_db\".\"dwh_facts\".\"fait_attributions\"\n),\n\nlots as (\n    select * from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_lots\"\n),\n\nclients_stats as (\n    select\n        e.entreprise_id,\n        e.raison_sociale,\n        e.forme_juridique,\n        e.registre_commerce,\n        e.telephone,\n        e.email,\n        d.nom_domaine as secteur_activite,\n        \n        -- Facturation\n        count(distinct f.facture_id) as nombre_factures,\n        sum(f.montant_total) as chiffre_affaires_total,\n        sum(case when f.est_paye then f.montant_total else 0 end) as ca_paye,\n        sum(case when not f.est_paye then f.montant_total else 0 end) as ca_impaye,\n        \n        -- Comportement de paiement\n        avg(f.delai_paiement_jours) as delai_moyen_paiement,\n        count(case when f.est_en_retard then 1 end) as nombre_factures_retard,\n        \n        round(\n            (count(case when f.est_paye then 1 end)::numeric / \n             nullif(count(f.facture_id), 0)::numeric * 100), \n            2\n        ) as taux_paiement_pct,\n        \n        -- Attributions\n        count(distinct a.demande_id) as nombre_demandes,\n        count(distinct case when a.est_approuve then a.demande_id end) as demandes_approuvees,\n        sum(case when a.est_approuve then a.superficie_demandee else 0 end) as superficie_totale_attribuee,\n        \n        -- Lots\n        count(distinct l.lot_id) as nombre_lots_attribues,\n        \n        -- Segmentation client\n        case \n            when sum(f.montant_total) > 10000000 then 'Grand client'\n            when sum(f.montant_total) > 1000000 then 'Client moyen'\n            else 'Petit client'\n        end as segment_client,\n        \n        case \n            when count(case when f.est_en_retard then 1 end)::numeric / \n                 nullif(count(f.facture_id), 0)::numeric > 0.3 then 'Risque \u00e9lev\u00e9'\n            when count(case when f.est_en_retard then 1 end)::numeric / \n                 nullif(count(f.facture_id), 0)::numeric > 0.1 then 'Risque moyen'\n            else 'Risque faible'\n        end as niveau_risque\n        \n    from entreprises e\n    left join domaines d on e.domaine_activite_id = d.domaine_id\n    left join factures f on e.entreprise_id = f.entreprise_id\n    left join attributions a on e.entreprise_id = a.entreprise_id\n    left join lots l on e.entreprise_id = l.entreprise_id and l.est_attribue\n    \n    group by \n        e.entreprise_id,\n        e.raison_sociale,\n        e.forme_juridique,\n        e.registre_commerce,\n        e.telephone,\n        e.email,\n        d.nom_domaine\n)\n\nselect * from clients_stats\norder by chiffre_affaires_total desc nulls last", "relation_name": "\"sigeti_node_db\".\"dwh_marts_clients\".\"mart_portefeuille_clients\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:33.109209Z", "completed_at": "2025-11-13T02:51:33.124026Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:33.129145Z", "completed_at": "2025-11-13T02:51:33.129145Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.019936084747314453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.mart_occupation_zones", "compiled": true, "compiled_code": "\n\n-- Mart Occupation - Analyse de l'occupation des lots et zones\n\nwith lots as (\n    select * from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_lots\"\n),\n\nzones as (\n    select * from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_zones_industrielles\"\n),\n\nentreprises as (\n    select * from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_entreprises\"\n),\n\nattributions as (\n    select * from \"sigeti_node_db\".\"dwh_facts\".\"fait_attributions\"\n),\n\noccupation_lots as (\n    select\n        z.zone_id,\n        z.nom_zone,\n        \n        -- Comptage des lots\n        count(*) as nombre_total_lots,\n        count(case when l.est_disponible then 1 end) as lots_disponibles,\n        count(case when l.est_attribue then 1 end) as lots_attribues,\n        count(case when not l.est_attribue and not l.est_disponible then 1 end) as lots_reserves,\n        \n        -- Surfaces\n        sum(l.superficie) as superficie_totale,\n        sum(case when l.est_disponible then l.superficie else 0 end) as superficie_disponible,\n        sum(case when l.est_attribue then l.superficie else 0 end) as superficie_attribuee,\n        \n        -- Taux d'occupation\n        round(\n            (count(case when l.est_attribue then 1 end)::numeric / \n             nullif(count(*), 0)::numeric * 100), \n            2\n        ) as taux_occupation_pct,\n        \n        -- Valeur\n        sum(l.prix) as valeur_totale_lots,\n        sum(case when l.est_disponible then l.prix else 0 end) as valeur_lots_disponibles,\n        \n        -- Viabilit\u00e9\n        count(case when l.est_viable then 1 end) as lots_viabilises,\n        round(\n            (count(case when l.est_viable then 1 end)::numeric / \n             nullif(count(*), 0)::numeric * 100), \n            2\n        ) as taux_viabilisation_pct\n        \n    from lots l\n    left join zones z on l.zone_industrielle_id = z.zone_id\n    \n    group by \n        z.zone_id,\n        z.nom_zone\n),\n\nattributions_stats as (\n    select\n        a.zone_id,\n        \n        count(*) as nombre_demandes_attribution,\n        count(case when a.est_approuve then 1 end) as demandes_approuvees,\n        count(case when a.est_rejete then 1 end) as demandes_rejetees,\n        count(case when a.est_en_attente then 1 end) as demandes_en_attente,\n        \n        avg(a.delai_traitement_jours) as delai_moyen_traitement,\n        \n        round(\n            (count(case when a.est_approuve then 1 end)::numeric / \n             nullif(count(*), 0)::numeric * 100), \n            2\n        ) as taux_approbation_pct\n        \n    from attributions a\n    \n    group by a.zone_id\n)\n\nselect\n    o.*,\n    a.nombre_demandes_attribution,\n    a.demandes_approuvees,\n    a.demandes_rejetees,\n    a.demandes_en_attente,\n    a.delai_moyen_traitement,\n    a.taux_approbation_pct\n    \nfrom occupation_lots o\nleft join attributions_stats a on o.zone_id = a.zone_id", "relation_name": "\"sigeti_node_db\".\"dwh_marts_occupation\".\"mart_occupation_zones\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T02:51:33.118994Z", "completed_at": "2025-11-13T02:51:33.129145Z"}, {"name": "execute", "started_at": "2025-11-13T02:51:33.129145Z", "completed_at": "2025-11-13T02:51:33.129145Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.019936084747314453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.mart_performance_financiere", "compiled": true, "compiled_code": "\n\n-- Mart Financier - Vue compl\u00e8te pour analyse financi\u00e8re\n\nwith factures as (\n    select * from \"sigeti_node_db\".\"dwh_facts\".\"fait_factures\"\n),\n\npaiements as (\n    select * from \"sigeti_node_db\".\"dwh_facts\".\"fait_paiements\"\n),\n\ncollectes as (\n    select * from \"sigeti_node_db\".\"dwh_facts\".\"fait_collectes\"\n),\n\nentreprises as (\n    select * from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_entreprises\"\n),\n\nzones as (\n    select * from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_zones_industrielles\"\n),\n\ntemps as (\n    select * from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_temps\"\n),\n\nfactures_aggregees as (\n    select\n        t.annee,\n        t.mois,\n        t.trimestre,\n        e.raison_sociale,\n        e.domaine_activite_id,\n        z.nom_zone,\n        \n        -- M\u00e9triques de facturation\n        count(distinct f.facture_id) as nombre_factures,\n        sum(f.montant_total) as montant_total_facture,\n        sum(case when f.est_paye then f.montant_total else 0 end) as montant_paye,\n        sum(case when not f.est_paye then f.montant_total else 0 end) as montant_impaye,\n        \n        -- D\u00e9lais\n        avg(f.delai_paiement_jours) as delai_moyen_paiement,\n        \n        -- Taux\n        round(\n            (sum(case when f.est_paye then f.montant_total else 0 end)::numeric / \n             nullif(sum(f.montant_total), 0)::numeric * 100), \n            2\n        ) as taux_paiement_pct\n        \n    from factures f\n    join temps t on f.date_creation_key = t.date_key\n    left join entreprises e on f.entreprise_id = e.entreprise_id\n    left join collectes c on f.collecte_id = c.collecte_id\n    left join zones z on c.collecte_id = z.zone_id  -- \u00c0 ajuster selon votre mod\u00e8le\n    \n    group by \n        t.annee,\n        t.mois,\n        t.trimestre,\n        e.raison_sociale,\n        e.domaine_activite_id,\n        z.nom_zone\n),\n\ncollectes_aggregees as (\n    select\n        t.annee,\n        t.trimestre,\n        \n        -- M\u00e9triques de collecte\n        count(distinct c.collecte_id) as nombre_collectes,\n        sum(c.montant_a_recouvrer) as montant_total_a_recouvrer,\n        sum(c.montant_recouvre) as montant_total_recouvre,\n        avg(c.taux_recouvrement) as taux_recouvrement_moyen,\n        avg(c.duree_reelle_jours) as duree_moyenne_collecte\n        \n    from collectes c\n    join temps t on c.date_debut_key = t.date_key\n    \n    group by \n        t.annee,\n        t.trimestre\n)\n\nselect\n    -- Utiliser les factures comme base principale\n    f.*,\n    c.nombre_collectes,\n    c.montant_total_a_recouvrer,\n    c.montant_total_recouvre,\n    c.taux_recouvrement_moyen\n    \nfrom factures_aggregees f\nleft join collectes_aggregees c \n    on f.annee = c.annee \n    and f.trimestre = c.trimestre", "relation_name": "\"sigeti_node_db\".\"dwh_marts_financier\".\"mart_performance_financiere\"", "batch_results": null}], "elapsed_time": 0.8601372241973877, "args": {"favor_state": false, "strict_mode": false, "source_freshness_run_project_hooks": true, "show_all_deprecations": false, "use_colors_file": true, "skip_nodes_if_on_run_start_fails": false, "log_level": "info", "exclude": [], "require_nested_cumulative_type_params": false, "printer_width": 80, "validate_macro_args": false, "vars": {}, "warn_error_options": {"error": [], "warn": [], "silence": []}, "macro_debugging": false, "static": false, "partial_parse_file_diff": true, "indirect_selection": "eager", "project_dir": "C:\\Users\\hynco\\Desktop\\DWH_SIG", "require_resource_names_without_spaces": true, "require_batched_execution_for_custom_microbatch_strategy": false, "require_all_warnings_handled_by_warn_error": false, "empty_catalog": false, "print": true, "state_modified_compare_vars": false, "compile": true, "quiet": false, "log_format": "default", "partial_parse": true, "populate_cache": true, "log_level_file": "debug", "introspect": true, "require_generic_test_arguments_property": true, "static_parser": true, "log_format_file": "debug", "defer": false, "cache_selected_only": false, "show_resource_report": false, "require_explicit_package_overrides_for_builtin_materializations": true, "use_colors": true, "state_modified_compare_more_unrendered_values": false, "version_check": true, "profiles_dir": "C:\\Users\\hynco\\Desktop\\DWH_SIG", "log_file_max_bytes": 10485760, "write_json": true, "send_anonymous_usage_stats": true, "upload_to_artifacts_ingest_api": false, "invocation_command": "dbt docs generate --profiles-dir C:\\Users\\hynco\\Desktop\\DWH_SIG --project-dir C:\\Users\\hynco\\Desktop\\DWH_SIG", "require_yaml_configuration_for_mf_time_spines": false, "log_path": "C:\\Users\\hynco\\Desktop\\DWH_SIG\\logs", "use_fast_test_edges": false, "select": [], "which": "generate"}}