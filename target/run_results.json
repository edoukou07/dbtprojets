{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.15", "generated_at": "2025-12-20T12:08:44.466580Z", "invocation_id": "e1b79d32-804d-4b52-9682-8373879ce440", "invocation_started_at": "2025-12-20T12:08:40.023413Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-20T12:08:42.665863Z", "completed_at": "2025-12-20T12:08:42.684965Z"}, {"name": "execute", "started_at": "2025-12-20T12:08:42.685957Z", "completed_at": "2025-12-20T12:08:44.385668Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.7227675914764404, "adapter_response": {"_message": "SELECT 17", "code": "SELECT", "rows_affected": 17}, "message": "SELECT 17", "failures": null, "unique_id": "model.sigeti_dwh.mart_suivi_impenses", "compiled": true, "compiled_code": "\n\n/*\n    ================================================================\n    Mart: Suivi des Dossiers d'Impenses\n    ================================================================\n    \n    Vue consolid\u00e9e de chaque dossier d'impense avec:\n    - Dur\u00e9e totale de traitement\n    - Temps pass\u00e9 dans chaque phase\n    - Indicateurs de performance et productivit\u00e9\n    - Indicateurs g\u00e9ographiques (zone industrielle)\n    - Indicateurs d'intervention par r\u00f4le\n    - Indicateurs de qualit\u00e9 et pr\u00e9diction\n    - Alertes sur les dossiers en retard\n    \n    Granularit\u00e9: Une ligne par dossier d'impense\n    \n    Utilisateurs: Direction, Gestionnaires de dossiers, Analystes\n    \n    Mise \u00e0 jour: D\u00e9cembre 2025 - Ajout indicateurs avanc\u00e9s\n*/\n\n-- =====================================================\n-- SECTION 1: M\u00e9triques par dossier depuis les faits\n-- =====================================================\nwith metriques_dossier as (\n    select\n        f.impense_id,\n        \n        -- Volume d'actions\n        count(*) as nb_actions_total,\n        count(distinct f.action) as nb_types_actions,\n        count(distinct f.agent_id) as nb_agents_impliques,\n        count(distinct f.user_role) as nb_roles_impliques,\n        \n        -- Premi\u00e8re et derni\u00e8re action\n        min(f.date_action) as date_premiere_action,\n        max(f.date_action) as date_derniere_action,\n        \n        -- Dur\u00e9e totale (en jours)\n        extract(day from (max(f.date_action) - min(f.date_action))) as duree_totale_jours,\n        extract(epoch from (max(f.date_action) - min(f.date_action))) / 3600 as duree_totale_heures,\n        \n        -- Temps par phase (agr\u00e9g\u00e9)\n        sum(case when p.phase_id = 1 then f.duree_minutes else 0 end) as temps_phase1_minutes,\n        sum(case when p.phase_id = 2 then f.duree_minutes else 0 end) as temps_phase2_minutes,\n        sum(case when p.phase_id = 3 then f.duree_minutes else 0 end) as temps_phase3_minutes,\n        sum(case when p.phase_id = 4 then f.duree_minutes else 0 end) as temps_phase4_minutes,\n        sum(case when p.phase_id = 5 then f.duree_minutes else 0 end) as temps_phase5_minutes,\n        sum(case when p.phase_id = 6 then f.duree_minutes else 0 end) as temps_phase6_minutes,\n        \n        -- Compteurs par type d'action\n        sum(f.est_validation) as nb_validations,\n        sum(f.est_rejet) as nb_rejets,\n        sum(f.est_correction) as nb_corrections,\n        sum(f.est_cloture) as nb_clotures,\n        \n        -- NOUVEAUX: Compteurs d'actions sp\u00e9cifiques\n        sum(case when f.action = 'RETOUR' then 1 else 0 end) as nb_retours,\n        sum(case when f.action = 'SOUMISSION' then 1 else 0 end) as nb_soumissions,\n        sum(case when f.action = 'UPLOAD_DOCUMENT' then 1 else 0 end) as nb_documents_uploades,\n        sum(case when f.action = 'INVALIDATION_RECEVABILITE' then 1 else 0 end) as nb_invalidations_recevabilite,\n        sum(case when f.action = 'VALIDATION_RECEVABILITE' then 1 else 0 end) as nb_validations_recevabilite,\n        \n        -- NOUVEAUX: Compteurs par r\u00f4le\n        sum(case when f.user_role = 'admin' then 1 else 0 end) as nb_interventions_admin,\n        sum(case when f.user_role = 'operateur' then 1 else 0 end) as nb_interventions_operateur,\n        sum(case when f.user_role = 'utilisateur' then 1 else 0 end) as nb_interventions_utilisateur,\n        \n        -- Derni\u00e8re phase atteinte\n        max(p.phase_id) as derniere_phase_atteinte,\n        \n        -- Phase avec le plus de temps\n        null::integer as phase_la_plus_longue  -- calcul\u00e9 plus bas\n        \n    from \"sigeti_node_db\".\"dwh_facts\".\"fait_workflow_impenses\" f\n    left join \"sigeti_node_db\".\"dwh_dimensions\".\"dim_phases_impenses\" p on f.phase_impense_key = p.phase_impense_key\n    group by f.impense_id\n),\n\n-- =====================================================\n-- SECTION 1B: Agent principal par dossier\n-- =====================================================\nagent_principal as (\n    select distinct on (impense_id)\n        impense_id,\n        agent_id as agent_principal_id,\n        user_role as agent_principal_role,\n        count(*) over (partition by impense_id, agent_id) as nb_actions_agent_principal\n    from \"sigeti_node_db\".\"dwh_facts\".\"fait_workflow_impenses\"\n    order by impense_id, count(*) over (partition by impense_id, agent_id) desc\n),\n\n-- =====================================================\n-- SECTION 1C: Temps entre actions (d\u00e9lai moyen de r\u00e9ponse)\n-- =====================================================\ndelais_entre_actions as (\n    select \n        impense_id,\n        date_action,\n        lag(date_action) over (partition by impense_id order by date_action) as date_action_precedente,\n        extract(epoch from (date_action - lag(date_action) over (partition by impense_id order by date_action))) / 3600 as delai_heures\n    from \"sigeti_node_db\".\"dwh_facts\".\"fait_workflow_impenses\"\n),\n\ndelais_actions as (\n    select \n        impense_id,\n        avg(delai_heures) as delai_moyen_reponse_heures,\n        max(delai_heures) as delai_max_reponse_heures\n    from delais_entre_actions\n    where delai_heures is not null\n    group by impense_id\n),\n\n-- =====================================================\n-- SECTION 1D: Zone industrielle\n-- =====================================================\nzones as (\n    select \n        id as zone_id,\n        code as zone_code,\n        libelle as zone_libelle,\n        adresse as zone_adresse,\n        superficie as zone_superficie_totale\n    from \"sigeti_node_db\".\"public\".\"zones_industrielles\"\n),\n\n-- =====================================================\n-- SECTION 1E: Informations lot enrichies\n-- =====================================================\nlots_info as (\n    select\n        l.id as lot_id,\n        l.numero as lot_numero,\n        l.superficie as lot_superficie,\n        l.prix as lot_prix,\n        l.statut as lot_statut,\n        l.viabilite as lot_viabilite,\n        l.zone_industrielle_id,\n        z.zone_code,\n        z.zone_libelle,\n        z.zone_adresse\n    from \"sigeti_node_db\".\"public\".\"lots\" l\n    left join zones z on l.zone_industrielle_id = z.zone_id\n),\n\n-- =====================================================\n-- SECTION 2: Jointure avec dimension impenses\n-- =====================================================\ndossiers_enrichis as (\n    select\n        di.impense_key,\n        di.impense_id,\n        di.numero_dossier,\n        \n        -- Lot avec enrichissement zone\n        di.lot_id,\n        coalesce(li.lot_numero, di.lot_numero) as lot_numero,\n        coalesce(li.lot_superficie, di.lot_superficie_m2) as lot_superficie_m2,\n        li.lot_prix,\n        li.lot_statut,\n        li.lot_viabilite,\n        di.zone_industrielle_id,\n        li.zone_code as zone_industrielle_code,\n        li.zone_libelle as zone_industrielle_libelle,\n        li.zone_adresse as zone_industrielle_adresse,\n        \n        -- Entreprise\n        di.entreprise_id,\n        di.nom_operateur,\n        di.nom_entreprise,\n        di.secteur_activite,\n        \n        -- Statut\n        di.statut_actuel,\n        di.statut_libelle,\n        di.phase_actuelle,\n        di.type_demande,\n        di.motif_cession,\n        \n        -- D\u00e9cisions\n        di.decision_verification,\n        di.resultat_analyse,\n        di.a_decision_verification,\n        di.a_resultat_analyse,\n        di.est_analyse,\n        di.est_cloture,\n        \n        -- Dates cl\u00e9s\n        di.date_creation,\n        di.date_emission,\n        di.date_transmission,\n        di.date_analyse,\n        \n        -- M\u00e9triques workflow de base\n        coalesce(m.nb_actions_total, 0) as nb_actions_total,\n        coalesce(m.nb_types_actions, 0) as nb_types_actions,\n        coalesce(m.nb_agents_impliques, 0) as nb_agents_impliques,\n        coalesce(m.nb_roles_impliques, 0) as nb_roles_impliques,\n        \n        m.date_premiere_action,\n        m.date_derniere_action,\n        coalesce(m.duree_totale_jours, 0) as duree_totale_jours,\n        coalesce(m.duree_totale_heures, 0) as duree_totale_heures,\n        \n        -- Temps par phase\n        coalesce(m.temps_phase1_minutes, 0) / 60.0 as temps_phase1_heures,\n        coalesce(m.temps_phase2_minutes, 0) / 60.0 as temps_phase2_heures,\n        coalesce(m.temps_phase3_minutes, 0) / 60.0 as temps_phase3_heures,\n        coalesce(m.temps_phase4_minutes, 0) / 60.0 as temps_phase4_heures,\n        coalesce(m.temps_phase5_minutes, 0) / 60.0 as temps_phase5_heures,\n        coalesce(m.temps_phase6_minutes, 0) / 60.0 as temps_phase6_heures,\n        \n        -- Compteurs de base\n        coalesce(m.nb_validations, 0) as nb_validations,\n        coalesce(m.nb_rejets, 0) as nb_rejets,\n        coalesce(m.nb_corrections, 0) as nb_corrections,\n        coalesce(m.nb_clotures, 0) as nb_clotures,\n        \n        -- NOUVEAUX: Compteurs actions sp\u00e9cifiques\n        coalesce(m.nb_retours, 0) as nb_retours,\n        coalesce(m.nb_soumissions, 0) as nb_soumissions,\n        coalesce(m.nb_documents_uploades, 0) as nb_documents_uploades,\n        coalesce(m.nb_invalidations_recevabilite, 0) as nb_invalidations_recevabilite,\n        coalesce(m.nb_validations_recevabilite, 0) as nb_validations_recevabilite,\n        \n        -- NOUVEAUX: Interventions par r\u00f4le\n        coalesce(m.nb_interventions_admin, 0) as nb_interventions_admin,\n        coalesce(m.nb_interventions_operateur, 0) as nb_interventions_operateur,\n        coalesce(m.nb_interventions_utilisateur, 0) as nb_interventions_utilisateur,\n        \n        -- NOUVEAUX: Agent principal\n        ap.agent_principal_id,\n        ap.agent_principal_role,\n        coalesce(ap.nb_actions_agent_principal, 0) as nb_actions_agent_principal,\n        \n        -- NOUVEAUX: D\u00e9lais de r\u00e9ponse\n        coalesce(da.delai_moyen_reponse_heures, 0) as delai_moyen_reponse_heures,\n        coalesce(da.delai_max_reponse_heures, 0) as delai_max_reponse_heures,\n        \n        m.derniere_phase_atteinte\n        \n    from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_impenses\" di\n    left join metriques_dossier m on di.impense_id = m.impense_id\n    left join agent_principal ap on di.impense_id = ap.impense_id\n    left join delais_actions da on di.impense_id = da.impense_id\n    left join lots_info li on di.lot_id = li.lot_id\n),\n\n-- =====================================================\n-- SECTION 3: Calculs finaux et alertes\n-- =====================================================\nfinal as (\n    select\n        -- ===========================================\n        -- IDENTIFICATION\n        -- ===========================================\n        impense_key,\n        impense_id,\n        numero_dossier,\n        \n        -- ===========================================\n        -- LOT ET ZONE INDUSTRIELLE\n        -- ===========================================\n        lot_id,\n        lot_numero,\n        lot_superficie_m2,\n        lot_prix,\n        lot_statut,\n        lot_viabilite,\n        zone_industrielle_id,\n        zone_industrielle_code,\n        zone_industrielle_libelle,\n        zone_industrielle_adresse,\n        \n        -- ===========================================\n        -- ENTREPRISE / OP\u00c9RATEUR\n        -- ===========================================\n        entreprise_id,\n        nom_operateur,\n        nom_entreprise,\n        secteur_activite,\n        \n        -- ===========================================\n        -- STATUT ET TYPE DE DEMANDE\n        -- ===========================================\n        statut_actuel,\n        statut_libelle,\n        phase_actuelle,\n        case phase_actuelle\n            when 1 then 'Phase 1: Cr\u00e9ation'\n            when 2 then 'Phase 2: V\u00e9rification'\n            when 3 then 'Phase 3: Analyse'\n            when 4 then 'Phase 4: Validation DI'\n            when 5 then 'Phase 5: Validation DG'\n            when 6 then 'Phase 6: Visite \u00e9valuation'\n            when 7 then 'Phase 7: Cl\u00f4ture'\n            else 'Non d\u00e9fini'\n        end as phase_actuelle_libelle,\n        type_demande,\n        motif_cession,\n        \n        -- ===========================================\n        -- D\u00c9CISIONS ET ANALYSE\n        -- ===========================================\n        decision_verification,\n        resultat_analyse,\n        a_decision_verification,\n        a_resultat_analyse,\n        est_analyse,\n        est_cloture,\n        \n        -- ===========================================\n        -- DATES CL\u00c9S\n        -- ===========================================\n        date_creation,\n        date_emission,\n        date_transmission,\n        date_analyse,\n        date_premiere_action,\n        date_derniere_action,\n        \n        -- ===========================================\n        -- INDICATEURS TEMPORELS AVANC\u00c9S\n        -- ===========================================\n        extract(week from date_creation) as semaine_creation,\n        to_char(date_creation, 'YYYY-MM') as mois_creation,\n        to_char(date_creation, 'YYYY') || '-Q' || extract(quarter from date_creation) as trimestre_creation,\n        extract(dow from date_creation) as jour_semaine_creation,\n        case when extract(dow from date_creation) in (0, 6) then true else false end as est_weekend_creation,\n        extract(day from (current_timestamp - date_creation)) as anciennete_dossier_jours,\n        \n        -- ===========================================\n        -- DUR\u00c9ES DE TRAITEMENT\n        -- ===========================================\n        round(duree_totale_jours::numeric, 1) as duree_totale_jours,\n        round(duree_totale_heures::numeric, 1) as duree_totale_heures,\n        \n        -- Temps par phase (heures)\n        round(temps_phase1_heures::numeric, 1) as temps_phase1_heures,\n        round(temps_phase2_heures::numeric, 1) as temps_phase2_heures,\n        round(temps_phase3_heures::numeric, 1) as temps_phase3_heures,\n        round(temps_phase4_heures::numeric, 1) as temps_phase4_heures,\n        round(temps_phase5_heures::numeric, 1) as temps_phase5_heures,\n        round(temps_phase6_heures::numeric, 1) as temps_phase6_heures,\n        \n        -- Phase la plus longue\n        case \n            when greatest(temps_phase1_heures, temps_phase2_heures, temps_phase3_heures, \n                         temps_phase4_heures, temps_phase5_heures, temps_phase6_heures) = temps_phase1_heures then 'Phase 1: Cr\u00e9ation'\n            when greatest(temps_phase1_heures, temps_phase2_heures, temps_phase3_heures, \n                         temps_phase4_heures, temps_phase5_heures, temps_phase6_heures) = temps_phase2_heures then 'Phase 2: V\u00e9rification'\n            when greatest(temps_phase1_heures, temps_phase2_heures, temps_phase3_heures, \n                         temps_phase4_heures, temps_phase5_heures, temps_phase6_heures) = temps_phase3_heures then 'Phase 3: Analyse'\n            when greatest(temps_phase1_heures, temps_phase2_heures, temps_phase3_heures, \n                         temps_phase4_heures, temps_phase5_heures, temps_phase6_heures) = temps_phase4_heures then 'Phase 4: Validation DI'\n            when greatest(temps_phase1_heures, temps_phase2_heures, temps_phase3_heures, \n                         temps_phase4_heures, temps_phase5_heures, temps_phase6_heures) = temps_phase5_heures then 'Phase 5: Validation DG'\n            else 'Phase 6: Visite'\n        end as phase_la_plus_longue,\n        \n        -- ===========================================\n        -- M\u00c9TRIQUES WORKFLOW (Volume)\n        -- ===========================================\n        nb_actions_total,\n        nb_types_actions,\n        nb_agents_impliques,\n        nb_roles_impliques,\n        nb_validations,\n        nb_rejets,\n        nb_corrections,\n        nb_clotures,\n        derniere_phase_atteinte,\n        \n        -- ===========================================\n        -- NOUVEAUX: COMPTEURS ACTIONS SP\u00c9CIFIQUES\n        -- ===========================================\n        nb_retours,\n        nb_soumissions,\n        nb_documents_uploades,\n        nb_invalidations_recevabilite,\n        nb_validations_recevabilite,\n        \n        -- Allers-retours (cycles de correction)\n        nb_retours as nb_allers_retours,\n        \n        -- ===========================================\n        -- NOUVEAUX: INDICATEURS PAR R\u00d4LE\n        -- ===========================================\n        nb_interventions_admin,\n        nb_interventions_operateur,\n        nb_interventions_utilisateur,\n        \n        -- Ratio admin/op\u00e9rateur\n        case \n            when nb_interventions_operateur > 0 \n            then round((nb_interventions_admin::float / nb_interventions_operateur)::numeric, 2)\n            else null \n        end as ratio_admin_operateur,\n        \n        -- ===========================================\n        -- NOUVEAUX: AGENT PRINCIPAL\n        -- ===========================================\n        agent_principal_id,\n        agent_principal_role,\n        nb_actions_agent_principal,\n        \n        -- ===========================================\n        -- NOUVEAUX: D\u00c9LAIS DE R\u00c9PONSE\n        -- ===========================================\n        round(delai_moyen_reponse_heures::numeric, 1) as delai_moyen_reponse_heures,\n        round(delai_max_reponse_heures::numeric, 1) as delai_max_reponse_heures,\n        \n        -- ===========================================\n        -- INDICATEURS DE PERFORMANCE\n        -- ===========================================\n        case \n            when nb_actions_total > 0 then round((nb_rejets::float / nb_actions_total * 100)::numeric, 1)\n            else 0 \n        end as taux_rejet_pct,\n        \n        case \n            when nb_actions_total > 0 then round((nb_corrections::float / nb_actions_total * 100)::numeric, 1)\n            else 0 \n        end as taux_correction_pct,\n        \n        -- NOUVEAU: Taux first pass (valid\u00e9 sans retour)\n        case \n            when nb_validations > 0 and nb_retours = 0 then 100.0\n            when nb_validations > 0 then round(((nb_validations - nb_retours)::float / nb_validations * 100)::numeric, 1)\n            else 0 \n        end as taux_first_pass_pct,\n        \n        -- NOUVEAU: Efficacit\u00e9 (actions par jour)\n        case \n            when duree_totale_jours > 0 then round((nb_actions_total::float / duree_totale_jours)::numeric, 2)\n            else nb_actions_total::numeric\n        end as efficacite_actions_par_jour,\n        \n        -- Jours depuis derni\u00e8re action\n        extract(day from (current_timestamp - date_derniere_action)) as jours_depuis_derniere_action,\n        \n        -- ===========================================\n        -- NOUVEAUX: INDICATEURS DE QUALIT\u00c9\n        -- ===========================================\n        -- Documents upload\u00e9s suffisants\n        case when nb_documents_uploades >= 2 then true else false end as a_documents_complets,\n        \n        -- Recevabilit\u00e9 valid\u00e9e\n        case when nb_validations_recevabilite > 0 then true else false end as recevabilite_validee,\n        \n        -- ===========================================\n        -- NOUVEAUX: INDICATEURS DE PR\u00c9DICTION\n        -- ===========================================\n        -- Dur\u00e9e estim\u00e9e restante (bas\u00e9e sur moyenne 5 jours/phase)\n        case \n            when statut_actuel = 'cl\u00f4tur\u00e9' then 0\n            else (7 - coalesce(derniere_phase_atteinte, phase_actuelle)) * 5\n        end as duree_estimee_restante_jours,\n        \n        -- Date estim\u00e9e de cl\u00f4ture\n        case \n            when statut_actuel = 'cl\u00f4tur\u00e9' then null\n            else current_date + ((7 - coalesce(derniere_phase_atteinte, phase_actuelle)) * 5)\n        end as date_estimee_cloture,\n        \n        -- Score de complexit\u00e9 (0-100)\n        least(100, (\n            nb_retours * 15 +\n            nb_agents_impliques * 5 +\n            nb_documents_uploades * 3 +\n            nb_invalidations_recevabilite * 20 +\n            case when duree_totale_jours > 30 then 20 else 0 end\n        )) as complexite_score,\n        \n        -- ===========================================\n        -- ALERTES ET FLAGS\n        -- ===========================================\n        case \n            when statut_actuel != 'cl\u00f4tur\u00e9' and extract(day from (current_timestamp - date_derniere_action)) > 7 then true\n            else false\n        end as est_inactif,\n        \n        case \n            when statut_actuel != 'cl\u00f4tur\u00e9' and duree_totale_jours > 30 then true\n            else false\n        end as est_en_retard,\n        \n        case \n            when nb_rejets > 2 then true\n            else false\n        end as a_rejets_multiples,\n        \n        case \n            when nb_corrections > 5 then true\n            else false\n        end as a_corrections_excessives,\n        \n        -- NOUVEAU: Risque d'abandon\n        case \n            when statut_actuel != 'cl\u00f4tur\u00e9' and extract(day from (current_timestamp - date_derniere_action)) > 30 then true\n            else false\n        end as risque_abandon,\n        \n        -- Score de sant\u00e9 du dossier (0-100, 100 = parfait)\n        100 - (\n            case when duree_totale_jours > 30 then 20 else 0 end +\n            case when nb_rejets > 2 then 20 else 0 end +\n            case when nb_corrections > 5 then 20 else 0 end +\n            case when extract(day from (current_timestamp - date_derniere_action)) > 7 and statut_actuel != 'cl\u00f4tur\u00e9' then 20 else 0 end +\n            case when phase_actuelle < derniere_phase_atteinte then 20 else 0 end\n        ) as score_sante_dossier,\n        \n        -- Niveau d'alerte\n        case \n            when statut_actuel = 'cl\u00f4tur\u00e9' then 'TERMINE'\n            when duree_totale_jours > 60 or nb_rejets > 3 then 'CRITIQUE'\n            when duree_totale_jours > 30 or nb_rejets > 2 then 'ALERTE'\n            when extract(day from (current_timestamp - date_derniere_action)) > 7 then 'ATTENTION'\n            else 'NORMAL'\n        end as niveau_alerte,\n        \n        -- ===========================================\n        -- NOUVEAUX: SLA / CONFORMIT\u00c9\n        -- ===========================================\n        -- SLA Phase 1 : max 2 jours\n        case when temps_phase1_heures <= 48 then true else false end as sla_phase1_respecte,\n        -- SLA Phase 2 : max 3 jours  \n        case when temps_phase2_heures <= 72 then true else false end as sla_phase2_respecte,\n        -- SLA Phase 3 : max 5 jours\n        case when temps_phase3_heures <= 120 then true else false end as sla_phase3_respecte,\n        \n        -- Nombre de SLA d\u00e9pass\u00e9s\n        (case when temps_phase1_heures > 48 then 1 else 0 end +\n         case when temps_phase2_heures > 72 then 1 else 0 end +\n         case when temps_phase3_heures > 120 then 1 else 0 end) as nb_sla_depasses,\n        \n        -- Taux conformit\u00e9 SLA\n        case \n            when derniere_phase_atteinte >= 3 then\n                round((\n                    (case when temps_phase1_heures <= 48 then 1 else 0 end +\n                     case when temps_phase2_heures <= 72 then 1 else 0 end +\n                     case when temps_phase3_heures <= 120 then 1 else 0 end)::float / 3 * 100\n                )::numeric, 1)\n            when derniere_phase_atteinte = 2 then\n                round((\n                    (case when temps_phase1_heures <= 48 then 1 else 0 end +\n                     case when temps_phase2_heures <= 72 then 1 else 0 end)::float / 2 * 100\n                )::numeric, 1)\n            when derniere_phase_atteinte = 1 then\n                case when temps_phase1_heures <= 48 then 100.0 else 0.0 end\n            else null\n        end as taux_conformite_sla_pct,\n        \n        -- ===========================================\n        -- METADATA\n        -- ===========================================\n        current_timestamp as dbt_created_at\n        \n    from dossiers_enrichis\n)\n\nselect * from final\norder by \n    case niveau_alerte \n        when 'CRITIQUE' then 1 \n        when 'ALERTE' then 2 \n        when 'ATTENTION' then 3 \n        when 'NORMAL' then 4 \n        else 5 \n    end,\n    duree_totale_jours desc", "relation_name": "\"sigeti_node_db\".\"dwh_marts_operationnel\".\"mart_suivi_impenses\"", "batch_results": null}], "elapsed_time": 2.575787305831909, "args": {"invocation_command": "dbt run --select mart_suivi_impenses", "skip_nodes_if_on_run_start_fails": false, "require_explicit_package_overrides_for_builtin_materializations": true, "upload_to_artifacts_ingest_api": false, "which": "run", "use_colors_file": true, "state_modified_compare_vars": false, "state_modified_compare_more_unrendered_values": false, "require_resource_names_without_spaces": true, "quiet": false, "favor_state": false, "use_colors": true, "exclude": [], "indirect_selection": "eager", "empty": false, "write_json": true, "show_resource_report": false, "require_nested_cumulative_type_params": false, "require_yaml_configuration_for_mf_time_spines": false, "warn_error_options": {"error": [], "warn": [], "silence": []}, "select": ["mart_suivi_impenses"], "log_level_file": "debug", "populate_cache": true, "require_batched_execution_for_custom_microbatch_strategy": false, "log_level": "info", "print": true, "send_anonymous_usage_stats": true, "show_all_deprecations": false, "static_parser": true, "vars": {}, "source_freshness_run_project_hooks": true, "partial_parse": true, "partial_parse_file_diff": true, "profiles_dir": "C:\\Users\\hynco\\Desktop\\DWH_SIG", "version_check": true, "log_file_max_bytes": 10485760, "printer_width": 80, "require_generic_test_arguments_property": true, "strict_mode": false, "use_fast_test_edges": false, "log_format": "default", "require_all_warnings_handled_by_warn_error": false, "macro_debugging": false, "log_format_file": "debug", "introspect": true, "defer": false, "project_dir": "C:\\Users\\hynco\\Desktop\\DWH_SIG", "validate_macro_args": false, "log_path": "C:\\Users\\hynco\\Desktop\\DWH_SIG\\logs", "cache_selected_only": false}}