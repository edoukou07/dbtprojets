{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.15", "generated_at": "2025-11-13T04:51:42.584708Z", "invocation_id": "22ca2bc4-d259-4519-aad4-47ed228c6d56", "invocation_started_at": "2025-11-13T04:51:39.994417Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:41.932876Z", "completed_at": "2025-11-13T04:51:41.943447Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:41.946976Z", "completed_at": "2025-11-13T04:51:41.946976Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.04827165603637695, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.stg_collectes", "compiled": true, "compiled_code": "\n\nselect\n    id,\n    reference,\n    montant_a_recouvrer,\n    montant_recouvre,\n    date_debut,\n    date_fin_prevue,\n    status,\n    commentaire,\n    cree_par,\n    modifie_par,\n    created_at,\n    updated_at,\n    statut_cloture,\n    date_cloture,\n    cloture_par,\n    entreprises_selectionnees,\n    factures_generees,\n    date_generation_factures\nfrom \"sigeti_node_db\".\"public\".\"collectes\"\nwhere id is not null", "relation_name": "\"sigeti_node_db\".\"dwh_staging\".\"stg_collectes\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:41.936426Z", "completed_at": "2025-11-13T04:51:41.944463Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:41.947976Z", "completed_at": "2025-11-13T04:51:41.947976Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.04827404022216797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.stg_demandes_attribution", "compiled": true, "compiled_code": "\n\nselect\n    id,\n    reference,\n    statut,\n    etape_courante,\n    type_demande,\n    entreprise_id,\n    lot_id,\n    zone_id,\n    informations_terrain,\n    coordonnees_geospatiales,\n    financement,\n    emplois,\n    priorite,\n    decisions_commissions,\n    historique_etapes,\n    retours,\n    metadata,\n    user_id,\n    created_at,\n    updated_at\nfrom \"sigeti_node_db\".\"public\".\"demandes_attribution\"\nwhere id is not null", "relation_name": "\"sigeti_node_db\".\"dwh_staging\".\"stg_demandes_attribution\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:41.939465Z", "completed_at": "2025-11-13T04:51:41.945968Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:41.949012Z", "completed_at": "2025-11-13T04:51:41.949012Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.04927420616149902, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.stg_domaines_activites", "compiled": true, "compiled_code": "\n\nselect\n    id,\n    libelle,\n    description,\n    created_at,\n    updated_at\nfrom \"sigeti_node_db\".\"public\".\"domaines_activites\"\nwhere id is not null", "relation_name": "\"sigeti_node_db\".\"dwh_staging\".\"stg_domaines_activites\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:41.959124Z", "completed_at": "2025-11-13T04:51:41.973647Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:41.975648Z", "completed_at": "2025-11-13T04:51:41.975648Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.02163386344909668, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.stg_entreprises", "compiled": true, "compiled_code": "\n\nselect\n    id,\n    raison_sociale,\n    telephone,\n    email,\n    registre_commerce,\n    compte_contribuable,\n    forme_juridique,\n    adresse,\n    date_constitution,\n    domaine_activite_id,\n    entreprise_id,\n    user_id,\n    date_creation,\n    date_modification\nfrom \"sigeti_node_db\".\"public\".\"entreprises\"\nwhere id is not null", "relation_name": "\"sigeti_node_db\".\"dwh_staging\".\"stg_entreprises\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:41.964123Z", "completed_at": "2025-11-13T04:51:41.973647Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:41.977162Z", "completed_at": "2025-11-13T04:51:41.977162Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.022188425064086914, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.stg_factures", "compiled": true, "compiled_code": "\n\nselect\n    id,\n    numero_facture,\n    date_creation,\n    date_echeance,\n    date_paiement,\n    montant_total,\n    sous_total,\n    statut,\n    entreprise_id,\n    processus_origine,\n    demande_attribution_id,\n    collecte_id,\n    ayant_droit_id,\n    created_by,\n    updated_by,\n    version,\n    is_deleted,\n    deleted_at,\n    purge_id\nfrom \"sigeti_node_db\".\"public\".\"factures\"\nwhere id is not null\n  and (is_deleted is null or is_deleted = false)", "relation_name": "\"sigeti_node_db\".\"dwh_staging\".\"stg_factures\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:41.968647Z", "completed_at": "2025-11-13T04:51:41.978169Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:41.981172Z", "completed_at": "2025-11-13T04:51:41.981172Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.025158405303955078, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.stg_lots", "compiled": true, "compiled_code": "\n\nselect\n    id,\n    numero,\n    ilot,\n    superficie,\n    unite_mesure,\n    prix,\n    statut,\n    priorite,\n    viabilite,\n    description,\n    coordonnees,\n    zone_industrielle_id,\n    zone_id,\n    entreprise_id,\n    date_acquisition,\n    date_reservation,\n    delai_option,\n    polygon,\n    location,\n    operateur_id,\n    created_at,\n    updated_at\nfrom \"sigeti_node_db\".\"public\".\"lots\"\nwhere id is not null", "relation_name": "\"sigeti_node_db\".\"dwh_staging\".\"stg_lots\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:41.996825Z", "completed_at": "2025-11-13T04:51:42.000829Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.001826Z", "completed_at": "2025-11-13T04:51:42.001826Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.015143632888793945, "adapter_response": {}, "message": null, "failures": null, "unique_id": "snapshot.sigeti_dwh.snapshot_entreprises", "compiled": true, "compiled_code": "\n\n\n\nselect * from \"sigeti_node_db\".\"public\".\"entreprises\"\n", "relation_name": "\"sigeti_node_db\".\"dwh_snapshots\".\"snapshot_entreprises\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:41.987683Z", "completed_at": "2025-11-13T04:51:42.000829Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.005003Z", "completed_at": "2025-11-13T04:51:42.005003Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.021833419799804688, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.stg_paiements", "compiled": true, "compiled_code": "\n\nselect\n    id,\n    facture_id,\n    montant,\n    date_paiement,\n    mode_paiement,\n    statut,\n    reference_paiement,\n    piece_justificative,\n    created_at,\n    updated_at\nfrom \"sigeti_node_db\".\"public\".\"paiement_factures\"\nwhere id is not null", "relation_name": "\"sigeti_node_db\".\"dwh_staging\".\"stg_paiements\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:41.992724Z", "completed_at": "2025-11-13T04:51:42.004001Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.007233Z", "completed_at": "2025-11-13T04:51:42.007233Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.025060653686523438, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.stg_zones_industrielles", "compiled": true, "compiled_code": "\n\nselect\n    id,\n    libelle,\n    description,\n    created_at,\n    updated_at\nfrom \"sigeti_node_db\".\"public\".\"zones_industrielles\"\nwhere id is not null", "relation_name": "\"sigeti_node_db\".\"dwh_staging\".\"stg_zones_industrielles\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.014229Z", "completed_at": "2025-11-13T04:51:42.102943Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.105951Z", "completed_at": "2025-11-13T04:51:42.105951Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.09678840637207031, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.source_not_null_sigeti_source_entreprises_id.377687be8a", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect id\nfrom \"sigeti_node_db\".\"public\".\"entreprises\"\nwhere id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.036466Z", "completed_at": "2025-11-13T04:51:42.105951Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.109061Z", "completed_at": "2025-11-13T04:51:42.109061Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0968325138092041, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.source_not_null_sigeti_source_factures_id.2ade065255", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect id\nfrom \"sigeti_node_db\".\"public\".\"factures\"\nwhere id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.096431Z", "completed_at": "2025-11-13T04:51:42.108036Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.111062Z", "completed_at": "2025-11-13T04:51:42.111062Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.09783339500427246, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.source_not_null_sigeti_source_lots_id.7c99ea6c34", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect id\nfrom \"sigeti_node_db\".\"public\".\"lots\"\nwhere id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.132244Z", "completed_at": "2025-11-13T04:51:42.148557Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.150517Z", "completed_at": "2025-11-13T04:51:42.150517Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.024278879165649414, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.source_not_null_sigeti_source_zones_industrielles_id.af9994522e", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect id\nfrom \"sigeti_node_db\".\"public\".\"zones_industrielles\"\nwhere id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:41.904022Z", "completed_at": "2025-11-13T04:51:42.130240Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.136756Z", "completed_at": "2025-11-13T04:51:42.136756Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.25384950637817383, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.dim_temps", "compiled": true, "compiled_code": "\n\nwith date_spine as (\n    \n\n\n\n\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * power(2, 0)\n     + \n    \n    p1.generated_number * power(2, 1)\n     + \n    \n    p2.generated_number * power(2, 2)\n     + \n    \n    p3.generated_number * power(2, 3)\n     + \n    \n    p4.generated_number * power(2, 4)\n     + \n    \n    p5.generated_number * power(2, 5)\n     + \n    \n    p6.generated_number * power(2, 6)\n     + \n    \n    p7.generated_number * power(2, 7)\n     + \n    \n    p8.generated_number * power(2, 8)\n     + \n    \n    p9.generated_number * power(2, 9)\n     + \n    \n    p10.generated_number * power(2, 10)\n     + \n    \n    p11.generated_number * power(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 4017\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n\n    cast('2020-01-01' as date) + ((interval '1 day') * (row_number() over (order by 1) - 1))\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast('2030-12-31' as date)\n\n)\n\nselect * from filtered\n\n\n),\n\ndates as (\n    select\n        cast(date_day as date) as date_full,\n        cast(to_char(date_day, 'YYYYMMDD') as integer) as date_key,\n        extract(year from date_day) as annee,\n        extract(month from date_day) as mois,\n        extract(day from date_day) as jour,\n        extract(quarter from date_day) as trimestre,\n        extract(week from date_day) as semaine,\n        extract(dow from date_day) as jour_semaine,\n        to_char(date_day, 'Month') as nom_mois,\n        to_char(date_day, 'Day') as nom_jour,\n        case \n            when extract(month from date_day) between 1 and 3 then 'T1'\n            when extract(month from date_day) between 4 and 6 then 'T2'\n            when extract(month from date_day) between 7 and 9 then 'T3'\n            else 'T4'\n        end as libelle_trimestre,\n        case \n            when extract(dow from date_day) in (0, 6) then true\n            else false\n        end as est_weekend,\n        case \n            when extract(month from date_day) = 1 and extract(day from date_day) = 1 then 'Jour de l''An'\n            when extract(month from date_day) = 5 and extract(day from date_day) = 1 then 'F\u00eate du Travail'\n            when extract(month from date_day) = 8 and extract(day from date_day) = 7 then 'F\u00eate de l''Ind\u00e9pendance'\n            when extract(month from date_day) = 12 and extract(day from date_day) = 25 then 'No\u00ebl'\n            else null\n        end as jour_ferie\n    from date_spine\n)\n\nselect * from dates", "relation_name": "\"sigeti_node_db\".\"dwh_dimensions\".\"dim_temps\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.137752Z", "completed_at": "2025-11-13T04:51:42.151555Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.154518Z", "completed_at": "2025-11-13T04:51:42.154518Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.027240991592407227, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.source_unique_sigeti_source_entreprises_id.0e1558dbe3", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    id as unique_field,\n    count(*) as n_records\n\nfrom \"sigeti_node_db\".\"public\".\"entreprises\"\nwhere id is not null\ngroup by id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.143935Z", "completed_at": "2025-11-13T04:51:42.152553Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.156024Z", "completed_at": "2025-11-13T04:51:42.156024Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.026746511459350586, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.source_unique_sigeti_source_factures_id.fb4b49fadd", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    id as unique_field,\n    count(*) as n_records\n\nfrom \"sigeti_node_db\".\"public\".\"factures\"\nwhere id is not null\ngroup by id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.163312Z", "completed_at": "2025-11-13T04:51:42.200880Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.202877Z", "completed_at": "2025-11-13T04:51:42.202877Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0446012020111084, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.source_unique_sigeti_source_lots_id.a51cca0839", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    id as unique_field,\n    count(*) as n_records\n\nfrom \"sigeti_node_db\".\"public\".\"lots\"\nwhere id is not null\ngroup by id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.168898Z", "completed_at": "2025-11-13T04:51:42.201881Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.205929Z", "completed_at": "2025-11-13T04:51:42.205929Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.04564690589904785, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.source_unique_sigeti_source_zones_industrielles_id.752cef061d", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    id as unique_field,\n    count(*) as n_records\n\nfrom \"sigeti_node_db\".\"public\".\"zones_industrielles\"\nwhere id is not null\ngroup by id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.172897Z", "completed_at": "2025-11-13T04:51:42.204389Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.207939Z", "completed_at": "2025-11-13T04:51:42.207939Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.04662632942199707, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.fait_collectes", "compiled": true, "compiled_code": "\n\nwith collectes as (\n    select * from \"sigeti_node_db\".\"dwh_staging\".\"stg_collectes\"\n),\n\nfinal as (\n    select\n        -- Cl\u00e9 surrogate\n        md5(cast(coalesce(cast(id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(date_debut as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as collecte_key,\n        \n        -- Cl\u00e9s \u00e9trang\u00e8res (dimensions)\n        cast(to_char(date_debut, 'YYYYMMDD') as integer) as date_debut_key,\n        cast(to_char(date_fin_prevue, 'YYYYMMDD') as integer) as date_fin_prevue_key,\n        cast(to_char(date_cloture, 'YYYYMMDD') as integer) as date_cloture_key,\n        \n        -- Cl\u00e9s naturelles\n        id as collecte_id,\n        reference,\n        \n        -- Mesures\n        montant_a_recouvrer,\n        montant_recouvre,\n        montant_a_recouvrer - montant_recouvre as montant_restant,\n        \n        -- Ratios\n        case \n            when montant_a_recouvrer > 0 \n            then (montant_recouvre::numeric / montant_a_recouvrer::numeric) * 100\n            else 0\n        end as taux_recouvrement,\n        \n        -- Attributs\n        status,\n        statut_cloture,\n        \n        -- Dates\n        date_debut,\n        date_fin_prevue,\n        date_cloture,\n        date_generation_factures,\n        \n        -- Calculs\n        (date_fin_prevue - date_debut) as duree_prevue_jours,\n        \n        case \n            when date_cloture is not null \n            then (date_cloture::date - date_debut)\n            else (current_date - date_debut)\n        end as duree_reelle_jours,\n        \n        -- Indicateurs\n        factures_generees,\n        \n        case \n            when statut_cloture = 'cloturee' then true\n            else false\n        end as est_cloturee,\n        \n        case \n            when montant_recouvre >= montant_a_recouvrer then true\n            else false\n        end as est_complete,\n        \n        -- Audit\n        cree_par,\n        cloture_par\n        \n    from collectes\n    \n    \n        where date_debut >= (select max(date_debut) from \"sigeti_node_db\".\"dwh_facts\".\"fait_collectes\")\n    \n)\n\nselect * from final", "relation_name": "\"sigeti_node_db\".\"dwh_facts\".\"fait_collectes\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.196914Z", "completed_at": "2025-11-13T04:51:42.204389Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.209094Z", "completed_at": "2025-11-13T04:51:42.209094Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.04678082466125488, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.dim_domaines_activites", "compiled": true, "compiled_code": "\n\nwith source as (\n    select * from \"sigeti_node_db\".\"dwh_staging\".\"stg_domaines_activites\"\n),\n\ndomaines_enrichis as (\n    select\n        -- Cl\u00e9 surrogate\n        md5(cast(coalesce(cast(id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as domaine_key,\n        \n        -- Cl\u00e9s naturelles\n        id as domaine_id,\n        \n        -- Attributs\n        libelle as nom_domaine,\n        description,\n        \n        -- M\u00e9tadonn\u00e9es\n        created_at,\n        updated_at\n        \n    from source\n)\n\nselect * from domaines_enrichis", "relation_name": "\"sigeti_node_db\".\"dwh_dimensions\".\"dim_domaines_activites\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.218313Z", "completed_at": "2025-11-13T04:51:42.236722Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.239685Z", "completed_at": "2025-11-13T04:51:42.239685Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.02874159812927246, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.dim_entreprises", "compiled": true, "compiled_code": "\n\nwith source as (\n    select * from \"sigeti_node_db\".\"dwh_staging\".\"stg_entreprises\"\n),\n\nentreprises_enrichies as (\n    select\n        -- Cl\u00e9 surrogate\n        md5(cast(coalesce(cast(id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as entreprise_key,\n        \n        -- Cl\u00e9s naturelles\n        id as entreprise_id,\n        \n        -- Attributs\n        raison_sociale,\n        telephone,\n        email,\n        registre_commerce,\n        compte_contribuable,\n        forme_juridique,\n        adresse,\n        date_constitution,\n        \n        -- Cl\u00e9s \u00e9trang\u00e8res\n        domaine_activite_id,\n        user_id as representant_user_id,\n        \n        -- M\u00e9tadonn\u00e9es SCD Type 2\n        date_creation as valid_from,\n        date_modification as valid_to,\n        case \n            when date_modification is null then true \n            else false \n        end as is_current\n        \n    from source\n)\n\nselect * from entreprises_enrichies", "relation_name": "\"sigeti_node_db\".\"dwh_dimensions\".\"dim_entreprises\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.223317Z", "completed_at": "2025-11-13T04:51:42.238686Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.243690Z", "completed_at": "2025-11-13T04:51:42.243690Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.028738021850585938, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.fait_factures", "compiled": true, "compiled_code": "\n\nwith factures as (\n    select * from \"sigeti_node_db\".\"dwh_staging\".\"stg_factures\"\n),\n\nfinal as (\n    select\n        -- Cl\u00e9 surrogate\n        md5(cast(coalesce(cast(id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(date_creation as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as facture_key,\n        \n        -- Cl\u00e9s \u00e9trang\u00e8res (dimensions)\n        cast(to_char(date_creation, 'YYYYMMDD') as integer) as date_creation_key,\n        cast(to_char(coalesce(date_paiement, date_creation), 'YYYYMMDD') as integer) as date_paiement_key,\n        entreprise_id,\n        collecte_id,\n        demande_attribution_id,\n        ayant_droit_id,\n        \n        -- Cl\u00e9s naturelles\n        id as facture_id,\n        numero_facture,\n        \n        -- Mesures\n        montant_total,\n        sous_total,\n        montant_total - sous_total as montant_taxes,\n        \n        -- Attributs\n        statut,\n        processus_origine,\n        \n        -- Dates\n        date_creation,\n        date_echeance,\n        date_paiement,\n        \n        -- Calculs\n        case \n            when date_paiement is not null then date_paiement - date_creation\n            else current_date - date_creation\n        end as delai_paiement_jours,\n        \n        case \n            when date_paiement is null and current_date > date_echeance then true\n            else false\n        end as est_en_retard,\n        \n        case \n            when date_paiement is not null then true\n            else false\n        end as est_paye,\n        \n        -- Audit\n        created_by,\n        updated_by,\n        version\n        \n    from factures\n    \n    \n        where date_creation >= (select max(date_creation) from \"sigeti_node_db\".\"dwh_facts\".\"fait_factures\")\n    \n)\n\nselect * from final", "relation_name": "\"sigeti_node_db\".\"dwh_facts\".\"fait_factures\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.227902Z", "completed_at": "2025-11-13T04:51:42.241686Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.245686Z", "completed_at": "2025-11-13T04:51:42.245686Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.029699087142944336, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.dim_lots", "compiled": true, "compiled_code": "\n\nwith source as (\n    select * from \"sigeti_node_db\".\"dwh_staging\".\"stg_lots\"\n),\n\nlots_enrichis as (\n    select\n        -- Cl\u00e9 surrogate\n        md5(cast(coalesce(cast(id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as lot_key,\n        \n        -- Cl\u00e9s naturelles\n        id as lot_id,\n        numero as numero_lot,\n        ilot,\n        \n        -- Attributs\n        superficie,\n        unite_mesure,\n        prix,\n        statut,\n        priorite,\n        viabilite,\n        description,\n        coordonnees,\n        polygon,\n        location,\n        \n        -- Cl\u00e9s \u00e9trang\u00e8res\n        zone_industrielle_id,\n        zone_id,\n        entreprise_id,\n        operateur_id,\n        \n        -- Dates\n        date_acquisition,\n        date_reservation,\n        delai_option,\n        created_at,\n        updated_at,\n        \n        -- M\u00e9tadonn\u00e9es\n        case when statut = 'disponible' then true else false end as est_disponible,\n        case when viabilite = true then true else false end as est_viable,\n        case when entreprise_id is not null then true else false end as est_attribue\n        \n    from source\n)\n\nselect * from lots_enrichis", "relation_name": "\"sigeti_node_db\".\"dwh_dimensions\".\"dim_lots\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.231900Z", "completed_at": "2025-11-13T04:51:42.241686Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.246231Z", "completed_at": "2025-11-13T04:51:42.246231Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.030243396759033203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.fait_attributions", "compiled": true, "compiled_code": "\n\nwith demandes as (\n    select * from \"sigeti_node_db\".\"dwh_staging\".\"stg_demandes_attribution\"\n),\n\nlots as (\n    select \n        id,\n        superficie,\n        prix,\n        zone_industrielle_id\n    from \"sigeti_node_db\".\"dwh_staging\".\"stg_lots\"\n),\n\nfinal as (\n    select\n        -- Cl\u00e9 surrogate\n        md5(cast(coalesce(cast(d.id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(d.created_at as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as attribution_key,\n        \n        -- Cl\u00e9s \u00e9trang\u00e8res (dimensions)\n        cast(to_char(d.created_at, 'YYYYMMDD') as integer) as date_demande_key,\n        d.entreprise_id,\n        d.lot_id,\n        coalesce(d.zone_id, l.zone_industrielle_id) as zone_id,\n        \n        -- Cl\u00e9s naturelles\n        d.id as demande_id,\n        d.reference,\n        \n        -- Mesures\n        l.superficie as superficie_demandee,\n        l.prix as montant_attribution,\n        \n        -- Attributs\n        d.statut,\n        d.type_demande,\n        d.etape_courante,\n        d.priorite,\n        \n        -- Dates\n        d.created_at as date_demande,\n        d.updated_at as date_modification,\n        \n        -- Calculs\n        case \n            when d.updated_at is not null \n            then extract(day from (d.updated_at - d.created_at))\n            else extract(day from (current_timestamp - d.created_at))\n        end as delai_traitement_jours,\n        \n        -- Indicateurs\n        case \n            when d.statut::text in ('approuve', 'attribue', 'accepte') then true\n            else false\n        end as est_approuve,\n        \n        case \n            when d.statut::text = 'rejete' then true\n            else false\n        end as est_rejete,\n        \n        case \n            when d.statut::text in ('en_attente', 'en_cours') then true\n            else false\n        end as est_en_attente\n        \n    from demandes d\n    left join lots l on d.lot_id = l.id\n    \n    \n        where d.created_at >= (select max(date_demande) from \"sigeti_node_db\".\"dwh_facts\".\"fait_attributions\")\n    \n)\n\nselect * from final", "relation_name": "\"sigeti_node_db\".\"dwh_facts\".\"fait_attributions\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.254439Z", "completed_at": "2025-11-13T04:51:42.278992Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.281991Z", "completed_at": "2025-11-13T04:51:42.281991Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.033519744873046875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.fait_paiements", "compiled": true, "compiled_code": "\n\nwith paiements as (\n    select * from \"sigeti_node_db\".\"dwh_staging\".\"stg_paiements\"\n),\n\nfactures as (\n    select \n        id,\n        entreprise_id,\n        montant_total,\n        collecte_id\n    from \"sigeti_node_db\".\"dwh_staging\".\"stg_factures\"\n),\n\nfinal as (\n    select\n        -- Cl\u00e9 surrogate\n        md5(cast(coalesce(cast(p.id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(p.date_paiement as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as paiement_key,\n        \n        -- Cl\u00e9s \u00e9trang\u00e8res (dimensions)\n        cast(to_char(p.date_paiement, 'YYYYMMDD') as integer) as date_paiement_key,\n        f.entreprise_id,\n        p.facture_id,\n        f.collecte_id,\n        \n        -- Cl\u00e9s naturelles\n        p.id as paiement_id,\n        p.reference_paiement,\n        \n        -- Mesures\n        p.montant as montant_paiement,\n        f.montant_total as montant_facture,\n        f.montant_total - p.montant as reste_a_payer,\n        \n        -- Attributs\n        p.mode_paiement,\n        p.statut,\n        \n        -- Dates\n        p.date_paiement,\n        \n        -- Indicateurs\n        case \n            when p.montant >= f.montant_total then true\n            else false\n        end as paiement_complet,\n        \n        case \n            when p.montant < f.montant_total then true\n            else false\n        end as paiement_partiel\n        \n    from paiements p\n    left join factures f on p.facture_id = f.id\n    \n    \n        where p.date_paiement >= (select max(date_paiement) from \"sigeti_node_db\".\"dwh_facts\".\"fait_paiements\")\n    \n)\n\nselect * from final", "relation_name": "\"sigeti_node_db\".\"dwh_facts\".\"fait_paiements\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.260955Z", "completed_at": "2025-11-13T04:51:42.281023Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.283988Z", "completed_at": "2025-11-13T04:51:42.283988Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03255176544189453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.dim_zones_industrielles", "compiled": true, "compiled_code": "\n\nwith source as (\n    select * from \"sigeti_node_db\".\"dwh_staging\".\"stg_zones_industrielles\"\n),\n\nzones_enrichies as (\n    select\n        -- Cl\u00e9 surrogate\n        md5(cast(coalesce(cast(id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as zone_key,\n        \n        -- Cl\u00e9s naturelles\n        id as zone_id,\n        \n        -- Attributs\n        libelle as nom_zone,\n        description,\n        \n        -- M\u00e9tadonn\u00e9es\n        created_at,\n        updated_at\n        \n    from source\n)\n\nselect * from zones_enrichies", "relation_name": "\"sigeti_node_db\".\"dwh_dimensions\".\"dim_zones_industrielles\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.264955Z", "completed_at": "2025-11-13T04:51:42.282991Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.287204Z", "completed_at": "2025-11-13T04:51:42.287204Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.035804033279418945, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.dbt_utils_accepted_range_dim_temps_annee__2030__2020.e23d6033bb", "compiled": true, "compiled_code": "\n\nwith meet_condition as(\n  select *\n  from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_temps\"\n),\n\nvalidation_errors as (\n  select *\n  from meet_condition\n  where\n    -- never true, defaults to an empty result set. Exists to ensure any combo of the `or` clauses below succeeds\n    1 = 2\n    -- records with a value >= min_value are permitted. The `not` flips this to find records that don't meet the rule.\n    or not annee >= 2020\n    -- records with a value <= max_value are permitted. The `not` flips this to find records that don't meet the rule.\n    or not annee <= 2030\n)\n\nselect *\nfrom validation_errors\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.274473Z", "completed_at": "2025-11-13T04:51:42.286005Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.290202Z", "completed_at": "2025-11-13T04:51:42.290202Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.03673553466796875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.not_null_dim_temps_date_key.6400f2052f", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect date_key\nfrom \"sigeti_node_db\".\"dwh_dimensions\".\"dim_temps\"\nwhere date_key is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.296820Z", "completed_at": "2025-11-13T04:51:42.309987Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.315662Z", "completed_at": "2025-11-13T04:51:42.315662Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.024455547332763672, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.unique_dim_temps_date_key.3e71581568", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    date_key as unique_field,\n    count(*) as n_records\n\nfrom \"sigeti_node_db\".\"dwh_dimensions\".\"dim_temps\"\nwhere date_key is not null\ngroup by date_key\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.300821Z", "completed_at": "2025-11-13T04:51:42.315662Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.318710Z", "completed_at": "2025-11-13T04:51:42.318710Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.026506900787353516, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.dbt_utils_accepted_range_fait_collectes_montant_a_recouvrer__0.4269de27fe", "compiled": true, "compiled_code": "\n\nwith meet_condition as(\n  select *\n  from \"sigeti_node_db\".\"dwh_facts\".\"fait_collectes\"\n),\n\nvalidation_errors as (\n  select *\n  from meet_condition\n  where\n    -- never true, defaults to an empty result set. Exists to ensure any combo of the `or` clauses below succeeds\n    1 = 2\n    -- records with a value >= min_value are permitted. The `not` flips this to find records that don't meet the rule.\n    or not montant_a_recouvrer >= 0\n)\n\nselect *\nfrom validation_errors\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.305942Z", "completed_at": "2025-11-13T04:51:42.317672Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.321707Z", "completed_at": "2025-11-13T04:51:42.321707Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.027469635009765625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.not_null_dim_domaines_activites_domaine_key.343b367d40", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect domaine_key\nfrom \"sigeti_node_db\".\"dwh_dimensions\".\"dim_domaines_activites\"\nwhere domaine_key is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.310950Z", "completed_at": "2025-11-13T04:51:42.320671Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.323670Z", "completed_at": "2025-11-13T04:51:42.323670Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.027892112731933594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.unique_dim_domaines_activites_domaine_key.155c365d9f", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    domaine_key as unique_field,\n    count(*) as n_records\n\nfrom \"sigeti_node_db\".\"dwh_dimensions\".\"dim_domaines_activites\"\nwhere domaine_key is not null\ngroup by domaine_key\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.329283Z", "completed_at": "2025-11-13T04:51:42.350147Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.355920Z", "completed_at": "2025-11-13T04:51:42.355920Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.03321361541748047, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.dbt_utils_unique_combination_of_columns_dim_entreprises_entreprise_key.dc48c7db09", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        entreprise_key\n    from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_entreprises\"\n    group by entreprise_key\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.341772Z", "completed_at": "2025-11-13T04:51:42.354415Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.357929Z", "completed_at": "2025-11-13T04:51:42.357929Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03322148323059082, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.not_null_dim_entreprises_entreprise_key.e0e728a8e4", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect entreprise_key\nfrom \"sigeti_node_db\".\"dwh_dimensions\".\"dim_entreprises\"\nwhere entreprise_key is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.345767Z", "completed_at": "2025-11-13T04:51:42.356931Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.362964Z", "completed_at": "2025-11-13T04:51:42.362964Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.035711050033569336, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.not_null_dim_entreprises_raison_sociale.06fcf61ca1", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect raison_sociale\nfrom \"sigeti_node_db\".\"dwh_dimensions\".\"dim_entreprises\"\nwhere raison_sociale is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.351185Z", "completed_at": "2025-11-13T04:51:42.360969Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.365149Z", "completed_at": "2025-11-13T04:51:42.365149Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.02538156509399414, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.unique_dim_entreprises_entreprise_key.cfe8b48343", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    entreprise_key as unique_field,\n    count(*) as n_records\n\nfrom \"sigeti_node_db\".\"dwh_dimensions\".\"dim_entreprises\"\nwhere entreprise_key is not null\ngroup by entreprise_key\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.371738Z", "completed_at": "2025-11-13T04:51:42.395983Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.401993Z", "completed_at": "2025-11-13T04:51:42.401993Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.03629803657531738, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.dbt_utils_accepted_range_fait_factures_montant_total__10000000000__0.484092187b", "compiled": true, "compiled_code": "\n\nwith meet_condition as(\n  select *\n  from \"sigeti_node_db\".\"dwh_facts\".\"fait_factures\"\n),\n\nvalidation_errors as (\n  select *\n  from meet_condition\n  where\n    -- never true, defaults to an empty result set. Exists to ensure any combo of the `or` clauses below succeeds\n    1 = 2\n    -- records with a value >= min_value are permitted. The `not` flips this to find records that don't meet the rule.\n    or not montant_total >= 0\n    -- records with a value <= max_value are permitted. The `not` flips this to find records that don't meet the rule.\n    or not montant_total <= 10000000000\n)\n\nselect *\nfrom validation_errors\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.375739Z", "completed_at": "2025-11-13T04:51:42.400995Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.404191Z", "completed_at": "2025-11-13T04:51:42.404191Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.036452293395996094, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.dbt_utils_not_null_proportion_fait_factures_0_95__montant_total.ac19db171b", "compiled": true, "compiled_code": "\n\n\n\n\n\n\n\nwith validation as (\n  select\n    \n    sum(case when montant_total is null then 0 else 1 end) / cast(count(*) as numeric) as not_null_proportion\n  from \"sigeti_node_db\".\"dwh_facts\".\"fait_factures\"\n  \n),\nvalidation_errors as (\n  select\n    \n    not_null_proportion\n  from validation\n  where not_null_proportion < 0.95 or not_null_proportion > 1\n)\nselect\n  *\nfrom validation_errors\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.391407Z", "completed_at": "2025-11-13T04:51:42.402991Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.406706Z", "completed_at": "2025-11-13T04:51:42.406706Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.03796815872192383, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.dbt_utils_accepted_range_dim_lots_superficie__1000000__0.f847c7bf66", "compiled": true, "compiled_code": "\n\nwith meet_condition as(\n  select *\n  from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_lots\"\n),\n\nvalidation_errors as (\n  select *\n  from meet_condition\n  where\n    -- never true, defaults to an empty result set. Exists to ensure any combo of the `or` clauses below succeeds\n    1 = 2\n    -- records with a value >= min_value are permitted. The `not` flips this to find records that don't meet the rule.\n    or not superficie >= 0\n    -- records with a value <= max_value are permitted. The `not` flips this to find records that don't meet the rule.\n    or not superficie <= 1000000\n)\n\nselect *\nfrom validation_errors\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.396991Z", "completed_at": "2025-11-13T04:51:42.405697Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.408742Z", "completed_at": "2025-11-13T04:51:42.408742Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.038002729415893555, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.not_null_dim_lots_lot_key.5b25ed355c", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect lot_key\nfrom \"sigeti_node_db\".\"dwh_dimensions\".\"dim_lots\"\nwhere lot_key is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.414740Z", "completed_at": "2025-11-13T04:51:42.432040Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.438561Z", "completed_at": "2025-11-13T04:51:42.438561Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0288546085357666, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.unique_dim_lots_lot_key.d466e443bc", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    lot_key as unique_field,\n    count(*) as n_records\n\nfrom \"sigeti_node_db\".\"dwh_dimensions\".\"dim_lots\"\nwhere lot_key is not null\ngroup by lot_key\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.420323Z", "completed_at": "2025-11-13T04:51:42.437565Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.440594Z", "completed_at": "2025-11-13T04:51:42.440594Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.028852462768554688, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.mart_kpi_operationnels", "compiled": true, "compiled_code": "\n\n-- Mart Op\u00e9rationnel - Indicateurs de performance op\u00e9rationnelle\n-- Mat\u00e9rialis\u00e9 en table pour performance optimale des dashboards\n\nwith collectes as (\n    select * from \"sigeti_node_db\".\"dwh_facts\".\"fait_collectes\"\n),\n\nattributions as (\n    select * from \"sigeti_node_db\".\"dwh_facts\".\"fait_attributions\"\n),\n\nfactures as (\n    select * from \"sigeti_node_db\".\"dwh_facts\".\"fait_factures\"\n),\n\ntemps as (\n    select * from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_temps\"\n),\n\nperformance_collectes as (\n    select\n        t.annee,\n        t.trimestre,\n        t.nom_mois,\n        \n        -- Volume\n        count(*) as nombre_collectes,\n        count(case when c.est_cloturee then 1 end) as collectes_cloturees,\n        count(case when not c.est_cloturee then 1 end) as collectes_ouvertes,\n        \n        -- Performance\n        avg(c.taux_recouvrement) as taux_recouvrement_moyen,\n        avg(c.duree_reelle_jours) as duree_moyenne_jours,\n        \n        -- Volumes financiers\n        sum(c.montant_a_recouvrer) as montant_total_a_recouvrer,\n        sum(c.montant_recouvre) as montant_total_recouvre,\n        \n        -- Efficacit\u00e9\n        round(\n            (count(case when c.est_cloturee then 1 end)::numeric / \n             nullif(count(*), 0)::numeric * 100), \n            2\n        ) as taux_cloture_pct,\n        \n        round(\n            (sum(c.montant_recouvre)::numeric / \n             nullif(sum(c.montant_a_recouvrer), 0)::numeric * 100), \n            2\n        ) as taux_recouvrement_global_pct\n        \n    from collectes c\n    join temps t on c.date_debut_key = t.date_key\n    \n    group by \n        t.annee,\n        t.trimestre,\n        t.nom_mois\n),\n\nperformance_attributions as (\n    select\n        t.annee,\n        t.trimestre,\n        \n        count(*) as nombre_demandes,\n        count(case when a.est_approuve then 1 end) as demandes_approuvees,\n        count(case when a.est_rejete then 1 end) as demandes_rejetees,\n        count(case when a.est_en_attente then 1 end) as demandes_en_attente,\n        \n        avg(a.delai_traitement_jours) as delai_moyen_traitement,\n        \n        round(\n            (count(case when a.est_approuve then 1 end)::numeric / \n             nullif(count(*), 0)::numeric * 100), \n            2\n        ) as taux_approbation_pct,\n        \n        sum(a.superficie_demandee) as superficie_totale_demandee\n        \n    from attributions a\n    join temps t on a.date_demande_key = t.date_key\n    \n    group by \n        t.annee,\n        t.trimestre\n),\n\nperformance_facturation as (\n    select\n        t.annee,\n        t.trimestre,\n        \n        count(*) as nombre_factures_emises,\n        count(case when f.est_paye then 1 end) as factures_payees,\n        avg(case when f.est_paye then f.delai_paiement_jours end) as delai_moyen_paiement,\n        \n        sum(f.montant_total) as montant_total_facture,\n        sum(case when f.est_paye then f.montant_total else 0 end) as montant_paye\n        \n    from factures f\n    join temps t on f.date_creation_key = t.date_key\n    \n    group by \n        t.annee,\n        t.trimestre\n)\n\nselect\n    c.annee,\n    c.trimestre,\n    c.nom_mois,\n    \n    -- Collectes\n    c.nombre_collectes,\n    c.collectes_cloturees,\n    c.collectes_ouvertes,\n    c.taux_recouvrement_moyen,\n    c.duree_moyenne_jours as duree_moyenne_collecte_jours,\n    c.taux_cloture_pct,\n    c.taux_recouvrement_global_pct,\n    \n    -- Attributions\n    a.nombre_demandes,\n    a.demandes_approuvees,\n    a.demandes_rejetees,\n    a.demandes_en_attente,\n    a.delai_moyen_traitement as delai_moyen_attribution_jours,\n    a.taux_approbation_pct,\n    \n    -- Facturation\n    f.nombre_factures_emises,\n    f.factures_payees,\n    f.delai_moyen_paiement as delai_moyen_paiement_jours,\n    \n    -- Volumes financiers\n    c.montant_total_a_recouvrer,\n    c.montant_total_recouvre,\n    f.montant_total_facture,\n    f.montant_paye\n    \nfrom performance_collectes c\nleft join performance_attributions a \n    on c.annee = a.annee and c.trimestre = a.trimestre\nleft join performance_facturation f \n    on c.annee = f.annee and c.trimestre = f.trimestre\n    \norder by c.annee desc, c.trimestre desc", "relation_name": "\"sigeti_node_db\".\"dwh_marts_operationnel\".\"mart_kpi_operationnels\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.425831Z", "completed_at": "2025-11-13T04:51:42.439596Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.444771Z", "completed_at": "2025-11-13T04:51:42.444771Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.031057119369506836, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.mart_portefeuille_clients", "compiled": true, "compiled_code": "\n\n-- Mart Clients - Analyse du portefeuille clients/entreprises\n-- Mat\u00e9rialis\u00e9 en table pour performance optimale des dashboards\n\nwith entreprises as (\n    select * from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_entreprises\"\n),\n\ndomaines as (\n    select * from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_domaines_activites\"\n),\n\nfactures as (\n    select * from \"sigeti_node_db\".\"dwh_facts\".\"fait_factures\"\n),\n\nattributions as (\n    select * from \"sigeti_node_db\".\"dwh_facts\".\"fait_attributions\"\n),\n\nlots as (\n    select * from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_lots\"\n),\n\nclients_stats as (\n    select\n        e.entreprise_id,\n        e.raison_sociale,\n        e.forme_juridique,\n        e.registre_commerce,\n        e.telephone,\n        e.email,\n        d.nom_domaine as secteur_activite,\n        \n        -- Facturation\n        count(distinct f.facture_id) as nombre_factures,\n        sum(f.montant_total) as chiffre_affaires_total,\n        sum(case when f.est_paye then f.montant_total else 0 end) as ca_paye,\n        sum(case when not f.est_paye then f.montant_total else 0 end) as ca_impaye,\n        \n        -- Comportement de paiement\n        avg(f.delai_paiement_jours) as delai_moyen_paiement,\n        count(case when f.est_en_retard then 1 end) as nombre_factures_retard,\n        \n        round(\n            (count(case when f.est_paye then 1 end)::numeric / \n             nullif(count(f.facture_id), 0)::numeric * 100), \n            2\n        ) as taux_paiement_pct,\n        \n        -- Attributions\n        count(distinct a.demande_id) as nombre_demandes,\n        count(distinct case when a.est_approuve then a.demande_id end) as demandes_approuvees,\n        sum(case when a.est_approuve then a.superficie_demandee else 0 end) as superficie_totale_attribuee,\n        \n        -- Lots\n        count(distinct l.lot_id) as nombre_lots_attribues,\n        \n        -- Segmentation client\n        case \n            when sum(f.montant_total) > 10000000 then 'Grand client'\n            when sum(f.montant_total) > 1000000 then 'Client moyen'\n            else 'Petit client'\n        end as segment_client,\n        \n        case \n            when count(case when f.est_en_retard then 1 end)::numeric / \n                 nullif(count(f.facture_id), 0)::numeric > 0.3 then 'Risque \u00e9lev\u00e9'\n            when count(case when f.est_en_retard then 1 end)::numeric / \n                 nullif(count(f.facture_id), 0)::numeric > 0.1 then 'Risque moyen'\n            else 'Risque faible'\n        end as niveau_risque\n        \n    from entreprises e\n    left join domaines d on e.domaine_activite_id = d.domaine_id\n    left join factures f on e.entreprise_id = f.entreprise_id\n    left join attributions a on e.entreprise_id = a.entreprise_id\n    left join lots l on e.entreprise_id = l.entreprise_id and l.est_attribue\n    \n    group by \n        e.entreprise_id,\n        e.raison_sociale,\n        e.forme_juridique,\n        e.registre_commerce,\n        e.telephone,\n        e.email,\n        d.nom_domaine\n)\n\nselect * from clients_stats\norder by chiffre_affaires_total desc nulls last", "relation_name": "\"sigeti_node_db\".\"dwh_marts_clients\".\"mart_portefeuille_clients\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.432040Z", "completed_at": "2025-11-13T04:51:42.443771Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.447072Z", "completed_at": "2025-11-13T04:51:42.447072Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.03233194351196289, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.dbt_utils_accepted_range_fait_attributions_montant_attribution__100000000000__0.875607a45d", "compiled": true, "compiled_code": "\n\nwith meet_condition as(\n  select *\n  from \"sigeti_node_db\".\"dwh_facts\".\"fait_attributions\"\n),\n\nvalidation_errors as (\n  select *\n  from meet_condition\n  where\n    -- never true, defaults to an empty result set. Exists to ensure any combo of the `or` clauses below succeeds\n    1 = 2\n    -- records with a value >= min_value are permitted. The `not` flips this to find records that don't meet the rule.\n    or not montant_attribution >= 0\n    -- records with a value <= max_value are permitted. The `not` flips this to find records that don't meet the rule.\n    or not montant_attribution <= 100000000000\n)\n\nselect *\nfrom validation_errors\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.452039Z", "completed_at": "2025-11-13T04:51:42.485806Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.496855Z", "completed_at": "2025-11-13T04:51:42.496855Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.05205035209655762, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.dbt_utils_accepted_range_fait_attributions_superficie_demandee__50000__0.c9c43c17f7", "compiled": true, "compiled_code": "\n\nwith meet_condition as(\n  select *\n  from \"sigeti_node_db\".\"dwh_facts\".\"fait_attributions\"\n),\n\nvalidation_errors as (\n  select *\n  from meet_condition\n  where\n    -- never true, defaults to an empty result set. Exists to ensure any combo of the `or` clauses below succeeds\n    1 = 2\n    -- records with a value >= min_value are permitted. The `not` flips this to find records that don't meet the rule.\n    or not superficie_demandee >= 0\n    -- records with a value <= max_value are permitted. The `not` flips this to find records that don't meet the rule.\n    or not superficie_demandee <= 50000\n)\n\nselect *\nfrom validation_errors\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.458556Z", "completed_at": "2025-11-13T04:51:42.496855Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.498855Z", "completed_at": "2025-11-13T04:51:42.498855Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.05078005790710449, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.dbt_utils_recency_fait_attributions_day__date_modification__30.ab15a34498", "compiled": true, "compiled_code": "\n\n\n\n\n\n\nwith recency as (\n\n    select \n\n      \n      \n        max(date_modification) as most_recent\n\n    from \"sigeti_node_db\".\"dwh_facts\".\"fait_attributions\"\n\n    \n\n)\n\nselect\n\n    \n    most_recent,\n    cast(\n\n    now() + ((interval '1 day') * (-30))\n\n as timestamp) as threshold\n\nfrom recency\nwhere most_recent < cast(\n\n    now() + ((interval '1 day') * (-30))\n\n as timestamp)\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.480805Z", "completed_at": "2025-11-13T04:51:42.500856Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.504238Z", "completed_at": "2025-11-13T04:51:42.504238Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.05320167541503906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.dbt_utils_accepted_range_fait_paiements_montant_paiement__0.8d97acc173", "compiled": true, "compiled_code": "\n\nwith meet_condition as(\n  select *\n  from \"sigeti_node_db\".\"dwh_facts\".\"fait_paiements\"\n),\n\nvalidation_errors as (\n  select *\n  from meet_condition\n  where\n    -- never true, defaults to an empty result set. Exists to ensure any combo of the `or` clauses below succeeds\n    1 = 2\n    -- records with a value >= min_value are permitted. The `not` flips this to find records that don't meet the rule.\n    or not montant_paiement >= 0\n)\n\nselect *\nfrom validation_errors\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.490331Z", "completed_at": "2025-11-13T04:51:42.501857Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.505747Z", "completed_at": "2025-11-13T04:51:42.505747Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.048192501068115234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.not_null_fait_paiements_date_paiement_key.eb6d74d252", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect date_paiement_key\nfrom \"sigeti_node_db\".\"dwh_facts\".\"fait_paiements\"\nwhere date_paiement_key is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.512790Z", "completed_at": "2025-11-13T04:51:42.533129Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.541649Z", "completed_at": "2025-11-13T04:51:42.541649Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.034857749938964844, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.not_null_fait_paiements_montant_paiement.e8d2656d2f", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect montant_paiement\nfrom \"sigeti_node_db\".\"dwh_facts\".\"fait_paiements\"\nwhere montant_paiement is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.517322Z", "completed_at": "2025-11-13T04:51:42.540684Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.543648Z", "completed_at": "2025-11-13T04:51:42.543648Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03589153289794922, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.relationships_fait_paiements_date_paiement_key__date_key__ref_dim_temps_.cf9514b4f2", "compiled": true, "compiled_code": "\n    \n    \n\nwith child as (\n    select date_paiement_key as from_field\n    from \"sigeti_node_db\".\"dwh_facts\".\"fait_paiements\"\n    where date_paiement_key is not null\n),\n\nparent as (\n    select date_key as to_field\n    from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_temps\"\n)\n\nselect\n    from_field\n\nfrom child\nleft join parent\n    on child.from_field = parent.to_field\n\nwhere parent.to_field is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.529133Z", "completed_at": "2025-11-13T04:51:42.542649Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.546886Z", "completed_at": "2025-11-13T04:51:42.546886Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.03613090515136719, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.mart_occupation_zones", "compiled": true, "compiled_code": "\n\n-- Mart Occupation - Analyse de l'occupation des lots et zones\n-- Mat\u00e9rialis\u00e9 en table pour performance optimale des dashboards\n\nwith lots as (\n    select * from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_lots\"\n),\n\nzones as (\n    select * from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_zones_industrielles\"\n),\n\nentreprises as (\n    select * from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_entreprises\"\n),\n\nattributions as (\n    select * from \"sigeti_node_db\".\"dwh_facts\".\"fait_attributions\"\n),\n\noccupation_lots as (\n    select\n        z.zone_id,\n        z.nom_zone,\n        \n        -- Comptage des lots\n        count(*) as nombre_total_lots,\n        count(case when l.est_disponible then 1 end) as lots_disponibles,\n        count(case when l.est_attribue then 1 end) as lots_attribues,\n        count(case when not l.est_attribue and not l.est_disponible then 1 end) as lots_reserves,\n        \n        -- Surfaces\n        sum(l.superficie) as superficie_totale,\n        sum(case when l.est_disponible then l.superficie else 0 end) as superficie_disponible,\n        sum(case when l.est_attribue then l.superficie else 0 end) as superficie_attribuee,\n        \n        -- Taux d'occupation\n        round(\n            (count(case when l.est_attribue then 1 end)::numeric / \n             nullif(count(*), 0)::numeric * 100), \n            2\n        ) as taux_occupation_pct,\n        \n        -- Valeur\n        sum(l.prix) as valeur_totale_lots,\n        sum(case when l.est_disponible then l.prix else 0 end) as valeur_lots_disponibles,\n        \n        -- Viabilit\u00e9\n        count(case when l.est_viable then 1 end) as lots_viabilises,\n        round(\n            (count(case when l.est_viable then 1 end)::numeric / \n             nullif(count(*), 0)::numeric * 100), \n            2\n        ) as taux_viabilisation_pct\n        \n    from lots l\n    left join zones z on l.zone_industrielle_id = z.zone_id\n    \n    group by \n        z.zone_id,\n        z.nom_zone\n),\n\nattributions_stats as (\n    select\n        a.zone_id,\n        \n        count(*) as nombre_demandes_attribution,\n        count(case when a.est_approuve then 1 end) as demandes_approuvees,\n        count(case when a.est_rejete then 1 end) as demandes_rejetees,\n        count(case when a.est_en_attente then 1 end) as demandes_en_attente,\n        \n        avg(a.delai_traitement_jours) as delai_moyen_traitement,\n        \n        round(\n            (count(case when a.est_approuve then 1 end)::numeric / \n             nullif(count(*), 0)::numeric * 100), \n            2\n        ) as taux_approbation_pct\n        \n    from attributions a\n    \n    group by a.zone_id\n)\n\nselect\n    o.*,\n    a.nombre_demandes_attribution,\n    a.demandes_approuvees,\n    a.demandes_rejetees,\n    a.demandes_en_attente,\n    a.delai_moyen_traitement,\n    a.taux_approbation_pct\n    \nfrom occupation_lots o\nleft join attributions_stats a on o.zone_id = a.zone_id", "relation_name": "\"sigeti_node_db\".\"dwh_marts_occupation\".\"mart_occupation_zones\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.534131Z", "completed_at": "2025-11-13T04:51:42.545648Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.548892Z", "completed_at": "2025-11-13T04:51:42.548892Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.03809809684753418, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sigeti_dwh.mart_performance_financiere", "compiled": true, "compiled_code": "\n\n-- Mart Financier - Vue compl\u00e8te pour analyse financi\u00e8re\n-- Mat\u00e9rialis\u00e9 en table pour performance optimale des dashboards\n\nwith factures as (\n    select * from \"sigeti_node_db\".\"dwh_facts\".\"fait_factures\"\n),\n\npaiements as (\n    select * from \"sigeti_node_db\".\"dwh_facts\".\"fait_paiements\"\n),\n\ncollectes as (\n    select * from \"sigeti_node_db\".\"dwh_facts\".\"fait_collectes\"\n),\n\nentreprises as (\n    select * from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_entreprises\"\n),\n\nzones as (\n    select * from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_zones_industrielles\"\n),\n\ntemps as (\n    select * from \"sigeti_node_db\".\"dwh_dimensions\".\"dim_temps\"\n),\n\nfactures_aggregees as (\n    select\n        t.annee,\n        t.mois,\n        t.trimestre,\n        e.raison_sociale,\n        e.domaine_activite_id,\n        z.nom_zone,\n        \n        -- M\u00e9triques de facturation\n        count(distinct f.facture_id) as nombre_factures,\n        sum(f.montant_total) as montant_total_facture,\n        sum(case when f.est_paye then f.montant_total else 0 end) as montant_paye,\n        sum(case when not f.est_paye then f.montant_total else 0 end) as montant_impaye,\n        \n        -- D\u00e9lais\n        avg(f.delai_paiement_jours) as delai_moyen_paiement,\n        \n        -- Taux\n        round(\n            (sum(case when f.est_paye then f.montant_total else 0 end)::numeric / \n             nullif(sum(f.montant_total), 0)::numeric * 100), \n            2\n        ) as taux_paiement_pct\n        \n    from factures f\n    join temps t on f.date_creation_key = t.date_key\n    left join entreprises e on f.entreprise_id = e.entreprise_id\n    left join collectes c on f.collecte_id = c.collecte_id\n    left join zones z on c.collecte_id = z.zone_id  -- \u00c0 ajuster selon votre mod\u00e8le\n    \n    group by \n        t.annee,\n        t.mois,\n        t.trimestre,\n        e.raison_sociale,\n        e.domaine_activite_id,\n        z.nom_zone\n),\n\ncollectes_aggregees as (\n    select\n        t.annee,\n        t.trimestre,\n        \n        -- M\u00e9triques de collecte\n        count(distinct c.collecte_id) as nombre_collectes,\n        sum(c.montant_a_recouvrer) as montant_total_a_recouvrer,\n        sum(c.montant_recouvre) as montant_total_recouvre,\n        avg(c.taux_recouvrement) as taux_recouvrement_moyen,\n        avg(c.duree_reelle_jours) as duree_moyenne_collecte\n        \n    from collectes c\n    join temps t on c.date_debut_key = t.date_key\n    \n    group by \n        t.annee,\n        t.trimestre\n)\n\nselect\n    -- Utiliser les factures comme base principale\n    f.*,\n    c.nombre_collectes,\n    c.montant_total_a_recouvrer,\n    c.montant_total_recouvre,\n    c.taux_recouvrement_moyen\n    \nfrom factures_aggregees f\nleft join collectes_aggregees c \n    on f.annee = c.annee \n    and f.trimestre = c.trimestre", "relation_name": "\"sigeti_node_db\".\"dwh_marts_financier\".\"mart_performance_financiere\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.554889Z", "completed_at": "2025-11-13T04:51:42.572163Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.573194Z", "completed_at": "2025-11-13T04:51:42.573194Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.02529311180114746, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.not_null_dim_zones_industrielles_zone_key.ab3a76b1fa", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect zone_key\nfrom \"sigeti_node_db\".\"dwh_dimensions\".\"dim_zones_industrielles\"\nwhere zone_key is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T04:51:42.562677Z", "completed_at": "2025-11-13T04:51:42.573194Z"}, {"name": "execute", "started_at": "2025-11-13T04:51:42.574185Z", "completed_at": "2025-11-13T04:51:42.574185Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.022329330444335938, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sigeti_dwh.unique_dim_zones_industrielles_zone_key.c3bb4bc1fd", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    zone_key as unique_field,\n    count(*) as n_records\n\nfrom \"sigeti_node_db\".\"dwh_dimensions\".\"dim_zones_industrielles\"\nwhere zone_key is not null\ngroup by zone_key\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}], "elapsed_time": 1.1871058940887451, "args": {"use_colors_file": true, "upload_to_artifacts_ingest_api": false, "write_json": true, "cache_selected_only": false, "log_format_file": "debug", "log_file_max_bytes": 10485760, "require_all_warnings_handled_by_warn_error": false, "quiet": false, "source_freshness_run_project_hooks": true, "warn_error_options": {"error": [], "warn": [], "silence": []}, "exclude": [], "populate_cache": true, "skip_nodes_if_on_run_start_fails": false, "vars": {}, "show_resource_report": false, "indirect_selection": "eager", "log_level": "info", "state_modified_compare_more_unrendered_values": false, "validate_macro_args": false, "which": "generate", "compile": true, "printer_width": 80, "strict_mode": false, "use_colors": true, "invocation_command": "dbt docs generate --profiles-dir C:\\Users\\hynco\\Desktop\\DWH_SIG --project-dir C:\\Users\\hynco\\Desktop\\DWH_SIG", "favor_state": false, "require_nested_cumulative_type_params": false, "log_level_file": "debug", "show_all_deprecations": false, "static": false, "version_check": true, "send_anonymous_usage_stats": true, "project_dir": "C:\\Users\\hynco\\Desktop\\DWH_SIG", "partial_parse": true, "macro_debugging": false, "select": [], "use_fast_test_edges": false, "defer": false, "require_explicit_package_overrides_for_builtin_materializations": true, "state_modified_compare_vars": false, "print": true, "require_generic_test_arguments_property": true, "profiles_dir": "C:\\Users\\hynco\\Desktop\\DWH_SIG", "partial_parse_file_diff": true, "static_parser": true, "log_path": "C:\\Users\\hynco\\Desktop\\DWH_SIG\\logs", "require_yaml_configuration_for_mf_time_spines": false, "log_format": "default", "introspect": true, "empty_catalog": false, "require_resource_names_without_spaces": true, "require_batched_execution_for_custom_microbatch_strategy": false}}